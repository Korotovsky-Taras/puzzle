var te=(c,v)=>()=>(v||c((v={exports:{}}).exports,v),v.exports);var se=te((re,Ft)=>{(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))S(E);new MutationObserver(E=>{for(const _ of E)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&S(y)}).observe(document,{childList:!0,subtree:!0});function C(E){const _={};return E.integrity&&(_.integrity=E.integrity),E.referrerPolicy&&(_.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?_.credentials="include":E.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function S(E){if(E.ep)return;E.ep=!0;const _=C(E);fetch(E.href,_)}})();/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.2.2+39aa2571
 */(function(){function c(t){return typeof t=="function"||typeof t=="object"&&t!==null}function v(t){return typeof t=="function"}var C;Array.isArray?C=Array.isArray:C=function(t){return Object.prototype.toString.call(t)==="[object Array]"};var S=C,E=0,_,y,I=function(n,h){a[E]=n,a[E+1]=h,E+=2,E===2&&(y?y(u):P())};function O(t){y=t}function Y(t){I=t}var R=typeof window<"u"?window:void 0,M=R||{},L=M.MutationObserver||M.WebKitMutationObserver,k=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",V=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function nt(){return function(){process.nextTick(u)}}function $(){return function(){_(u)}}function b(){var t=0,n=new L(u),h=document.createTextNode("");return n.observe(h,{characterData:!0}),function(){h.data=t=++t%2}}function l(){var t=new MessageChannel;return t.port1.onmessage=u,function(){t.port2.postMessage(0)}}function r(){return function(){setTimeout(u,1)}}var a=new Array(1e3);function u(){for(var t=0;t<E;t+=2){var n=a[t],h=a[t+1];n(h),a[t]=void 0,a[t+1]=void 0}E=0}function p(){try{var t=require,n=t("vertx");return _=n.runOnLoop||n.runOnContext,$()}catch{return r()}}var P;k?P=nt():L?P=b():V?P=l():R===void 0&&typeof require=="function"?P=p():P=r();function A(t,n){var h=this,d=new this.constructor(lt);d[W]===void 0&&f(d);var m=h._state;if(m){var g=arguments[m-1];I(function(){B(m,d,g,h._result)})}else kt(h,d,t,n);return d}var z=A;function Q(t){var n=this;if(t&&typeof t=="object"&&t.constructor===n)return t;var h=new n(lt);return Z(h,t),h}var F=Q,W=Math.random().toString(36).substring(16);function lt(){}var ut=void 0,D=1,N=2,rt=new $t;function X(){return new TypeError("You cannot resolve a promise with itself")}function ot(){return new TypeError("A promises callback cannot return that same promise.")}function wt(t){try{return t.then}catch(n){return rt.error=n,rt}}function ft(t,n,h,d){try{t.call(n,h,d)}catch(m){return m}}function zt(t,n,h){I(function(d){var m=!1,g=ft(h,n,function(T){m||(m=!0,n!==T?Z(d,T):K(d,T))},function(T){m||(m=!0,q(d,T))},"Settle: "+(d._label||" unknown promise"));!m&&g&&(m=!0,q(d,g))},t)}function Ct(t,n){n._state===D?K(t,n._result):n._state===N?q(t,n._result):kt(n,void 0,function(h){Z(t,h)},function(h){q(t,h)})}function yt(t,n,h){n.constructor===t.constructor&&h===z&&constructor.resolve===F?Ct(t,n):h===rt?q(t,rt.error):h===void 0?K(t,n):v(h)?zt(t,n,h):K(t,n)}function Z(t,n){t===n?q(t,X()):c(n)?yt(t,n,wt(n)):K(t,n)}function tt(t){t._onerror&&t._onerror(t._result),Pt(t)}function K(t,n){t._state===ut&&(t._result=n,t._state=D,t._subscribers.length!==0&&I(Pt,t))}function q(t,n){t._state===ut&&(t._state=N,t._result=n,I(tt,t))}function kt(t,n,h,d){var m=t._subscribers,g=m.length;t._onerror=null,m[g]=n,m[g+D]=h,m[g+N]=d,g===0&&t._state&&I(Pt,t)}function Pt(t){var n=t._subscribers,h=t._state;if(n.length!==0){for(var d,m,g=t._result,T=0;T<n.length;T+=3)d=n[T],m=n[T+h],d?B(h,d,m,g):m(g);t._subscribers.length=0}}function $t(){this.error=null}var vt=new $t;function Et(t,n){try{return t(n)}catch(h){return vt.error=h,vt}}function B(t,n,h,d){var m=v(h),g,T,H,j;if(m){if(g=Et(h,d),g===vt?(j=!0,T=g.error,g=null):H=!0,n===g){q(n,ot());return}}else g=d,H=!0;n._state!==ut||(m&&H?Z(n,g):j?q(n,T):t===D?K(n,g):t===N&&q(n,g))}function Dt(t,n){try{n(function(d){Z(t,d)},function(d){q(t,d)})}catch(h){q(t,h)}}var i=0;function o(){return i++}function f(t){t[W]=i++,t._state=void 0,t._result=void 0,t._subscribers=[]}function w(t){return new _t(this,t).promise}var x=w;function U(t){var n=this;return S(t)?new n(function(h,d){for(var m=t.length,g=0;g<m;g++)n.resolve(t[g]).then(h,d)}):new n(function(h,d){d(new TypeError("You must pass an array to race."))})}var et=U;function bt(t){var n=this,h=new n(lt);return q(h,t),h}var dt=bt;function pt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function mt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ct=G;function G(t){this[W]=o(),this._result=this._state=void 0,this._subscribers=[],lt!==t&&(typeof t!="function"&&pt(),this instanceof G?Dt(this,t):mt())}G.all=x,G.race=et,G.resolve=F,G.reject=dt,G._setScheduler=O,G._setAsap=Y,G._asap=I,G.prototype={constructor:G,then:z,catch:function(t){return this.then(null,t)}};var _t=xt;function xt(t,n){this._instanceConstructor=t,this.promise=new t(lt),this.promise[W]||f(this.promise),S(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),this.length===0?K(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&K(this.promise,this._result))):q(this.promise,Xt())}function Xt(){return new Error("Array Methods must be provided an Array")}xt.prototype._enumerate=function(){for(var t=this.length,n=this._input,h=0;this._state===ut&&h<t;h++)this._eachEntry(n[h],h)},xt.prototype._eachEntry=function(t,n){var h=this._instanceConstructor,d=h.resolve;if(d===F){var m=wt(t);if(m===z&&t._state!==ut)this._settledAt(t._state,n,t._result);else if(typeof m!="function")this._remaining--,this._result[n]=t;else if(h===ct){var g=new h(lt);yt(g,t,m),this._willSettleAt(g,n)}else this._willSettleAt(new h(function(T){T(t)}),n)}else this._willSettleAt(d(t),n)},xt.prototype._settledAt=function(t,n,h){var d=this.promise;d._state===ut&&(this._remaining--,t===N?q(d,h):this._result[n]=h),this._remaining===0&&K(d,this._result)},xt.prototype._willSettleAt=function(t,n){var h=this;kt(t,void 0,function(d){h._settledAt(D,n,d)},function(d){h._settledAt(N,n,d)})};function e(){var t;if(typeof global<"u")t=global;else if(typeof self<"u")t=self;else try{t=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast||(t.Promise=ct)}var s=e;ct.Promise=ct,ct.polyfill=s,typeof define=="function"&&define.amd?define(function(){return ct}):typeof Ft<"u"&&Ft.exports?Ft.exports=ct:typeof this<"u"&&(this.Promise=ct),s()}).call(void 0);(function(){class c{constructor(){this._broadcastChannel=typeof BroadcastChannel>"u"?null:new BroadcastChannel("offline"),this._queuedMessages=[],this._onMessageCallback=null,this._broadcastChannel&&(this._broadcastChannel.onmessage=C=>this._OnBroadcastChannelMessage(C))}_OnBroadcastChannelMessage(C){if(this._onMessageCallback){this._onMessageCallback(C);return}this._queuedMessages.push(C)}SetMessageCallback(C){this._onMessageCallback=C;for(let S of this._queuedMessages)this._onMessageCallback(S);this._queuedMessages.length=0}}window.OfflineClientInfo=new c})();(function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js").then(function(){console.log("Service Worker Registered")});let c={},v=!0;window.PWATracker={getRequest:()=>c,getInstalled:()=>v},window.addEventListener("beforeinstallprompt",function(C){v=!1,C.preventDefault(),c=C})})();let qt=!1;function Ht(){}Ht.extend=function(c){const v=this.prototype;let C;qt=!0,C=new this,qt=!1;for(let E in c)typeof c[E]=="function"&&typeof v[E]=="function"?C[E]=function(_,y){return function(){const I=this._super;this._super=v[_];const O=y.apply(this,arguments);return this._super=I,O}}(E,c[E]):C[E]=c[E];function S(){if(this instanceof S)!qt&&this.init&&this.init.apply(this,arguments);else return new S(...arguments)}return S.prototype=C,S.prototype.constructor=S,S.extend=this.extend,S};function ee(c){let v=Math,C=v.PI,S=2*C,E=C/180,_=v.sqrt,y=v.pow,I=v.cos,O=v.sin,Y=v.round,R=v.abs,M=v.acos,L,k=Object.prototype.hasOwnProperty,V=Array.prototype.slice,nt={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},$=document.createElement("canvas"),b=$.getContext&&$.getContext("2d"),l=function(e,s){return _(y(e.x-s.x,2)+y(e.y-s.y,2))},r=function(e,s,t,n,h){let d=t-e,m=n-s,g={},T;if(!(d===0&&m===0))return T=((h.x-e)*d+(h.y-s)*m)/(d*d+m*m),T<0?g={x:e,y:s}:T>1?g={x:t,y:t}:g={x:e+T*d,y:s+T*m},l(g,h)},a=function(e,s,t){return t=E*t,{x:e*I(t)-s*O(t),y:e*O(t)+s*I(t)}},u=function(e,s){let t;for(t in s)k.call(s,t)&&(e[t]=s[t])},p=Ht.extend({init:function(e,s){this.x=e||0,this.y=s||0,u(this,nt)},position:function(){let e=a(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:e.x+this.tx,y:e.y+this.ty}},rmove:function(e,s){this.tx+=e,this.ty+=s},attr:function(e,s){let t;if(typeof e=="string")this[e]=s;else for(t in e)this[t]=e[t];return this},applyStyle:function(e){let s=this.shadowBlur,t=this.shadowOffsetX,n=this.shadowOffsetY;e.fillStyle=this.fill,e.globalAlpha=this.alpha,e.globalCompositeOperation=this.composite,this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.lineWidth),(t||n||s)&&(e.shadowColor=this.shadowColor,e.shadowOffsetX=t,e.shadowOffsetY=n,e.shadowBlur=s)},setTransform:function(e){let s=c.__zoom,t=this.scaleX*s,n=this.scaleY*s,h=this.skewX*s,d=this.skewY*s,m=this.rotation*E,g=O(m),T=I(m),H=this.tx*s,j=this.ty*s,ht=T*t-g*d,at=T*h-g*n,Tt=g*t+T*d,St=g*h+T*n;e.setTransform(ht,Tt,at,St,H,j)},draw:function(e){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(e){this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(b&&b.isPointInPath)return this.draw(b),b.setTransform(1,0,0,1,0,0),b.isPointInPath(e.x,e.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),P=p.extend({init:function(e,s,t,n,h){this.r=h||0,this.w=t||5,this.h=n||t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y,n=this.w,h=this.h;this.applyStyle(e),this.setTransform(e),e.beginPath(),this.r?c.setContext(e).polygon(s,t,s+n,t,s+n,t+h,s,t+h,this.r):e.rect(s,t,Y(n),Y(h)),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.r)return this._super(e);let s=this.position(),t=a(e.x-s.x,e.y-s.y,-this.rotation);return t.x>=0&&t.x<=this.w*this.scaleX&&t.y>=0&&t.y<=this.h*this.scaleY}}),A=P.extend({init:function(e,s,t){this.setText(t),this._super(e,s,this.w,this.h)},applyStyle:function(e){e.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=e.measureText(this.text).width,this._super(e)},setText:function(e){this.text=e+""},draw:function(e){this.applyStyle(e),this.setTransform(e),this.fill&&e.fillText(this.text,this.x,this.y+this.h),this.stroke&&e.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(e){return this.skewX||this.skewY&&b&&b.isPointInPath?(this.setTransform(b),b.beginPath(),b.rect(this.x,this.y,this.w,this.h),b.closePath(),b.isPointInPath(e.x,e.y)):this._super(e)}}),z={},Q=P.extend({init:function(e,s,t){this.setImg(t),this._super(e,s,this.img.width,this.img.height)},setImg:function(e){if(z[e]){this.img=z[e],this.src=this.img.src;return}e.nodeName=="IMG"?this.img=e:(e+="",this.img=z[e]=new Image,this.img.src=e),this.img.onload=function(){c.forse_redraw()},this.src=this.img.src},draw:function(e){let s=this.x,t=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(e),this.setTransform(e),e===b?(e.beginPath(),e.rect(s,t,Y(this.w),Y(this.h)),e.closePath()):e.drawImage(this.img,s,t)}}),F=P.extend({draw:function(e){let s=this.x,t=this.y,n=this.w,h=this.h,d=.5522847498307933,m=d*n,g=d*h;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(s+n,t),e.bezierCurveTo(s+n,t-g,s+m,t-h,s,t-h),e.bezierCurveTo(s-m,t-h,s-n,t-g,s-n,t),e.bezierCurveTo(s-n,t+g,s-m,t+h,s,t+h),e.bezierCurveTo(s+m,t+h,s+n,t+g,s+n,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:p.prototype.hitTest}),W=p.extend({init:function(e,s,t,n,h,d){this.clockwise=d,this.endAngle=h,this.startAngle=n,this.r=t,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,Y(this.r),this.startAngle||C*2,this.endAngle||0,!!this.clockwise),e.lineTo(s,t),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()}}),lt=p.extend({init:function(e,s,t){this.r=t||5,this._super(e,s)},draw:function(e){let s=this.x,t=this.y;this.applyStyle(e),this.setTransform(e),e.beginPath(),e.arc(s,t,Y(this.r),0,C*2,!0),e.closePath(),this.fill&&e.fill(),this.stroke&&e.stroke()},hitTest:function(e){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(e);let s=!!this.stroke&&this.lineWidth,t=this.position();return l(e,t)<=(this.r+s)*this.scaleX}}),ut=p.extend({init:function(e,s,t,n){this.x2=t,this.y2=n,this._super(e,s),this.stroke="#000"},rmove:function(e,s){this.x+=e,this.y+=s,this.x2+=e,this.y2+=s},applyStyle:function(e){e.lineJoin=this.lineJoin,e.lineCap=this.lineCap,this._super(e)},draw:function(e){this.applyStyle(e),this.setTransform(e),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x2,this.y2),e.stroke()},hitTest:function(e){return r(this.x,this.y,this.x2,this.y2,e)<=this.lineWidth+2}}),D,N,rt,X=null,ot=null,wt=!1,ft=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,zt=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Ct=function(e,s,t,n){let h=e*t+s*n,d=_(e*e+s*s),m=_(t*t+n*n),g=h/(d*m),T,H;return g>1?g=1:g<-1&&(g=-1),T=R(M(g)),H=e*n-s*t,H===R(H)?T:-T},yt=function(e,s,t){return[e*I(t)-s*O(t),s*I(t)+e*O(t)]},Z=function(e,s,t){wt&&e.ctx.moveTo(s,t)},tt=function(e,s){D=e,N=s,X=null,ot=null,wt=!1},K=function(){if(D===L)throw new Error("No current point; can't use relative coordinates")},q=function(e,s,t,n){if(s!==(t?e.length%t:e.length)||e.length<n)throw new Error("wrong number of arguments")},kt=function(e,s){return this.ctx.moveTo(e,s),tt(e,s),rt=e,arguments.length>2&&$t.apply(this,V.call(arguments,2)),this},Pt=function(e,s){return wt&&(D=N=0),K(),e+=D,s+=N,this.ctx.moveTo(e,s),tt(e,s),rt=e,arguments.length>2&&vt.apply(this,V.call(arguments,2)),this},$t=function(e,s){let t,n=arguments.length;for(q(arguments,0,2,2),Z(this,e,s),this.ctx.lineTo(e,s),t=2;t<n;t+=2)this.ctx.lineTo(e=arguments[t],s=arguments[t+1]);return tt(e,s),this},vt=function(e,s){let t,n=D,h=N,d=arguments.length;for(q(arguments,0,2,2),K(),t=0;t<d;t+=2)this.ctx.lineTo(n+=arguments[t],h+=arguments[t+1]);return tt(n,h),this},Et=function(){return this.ctx.closePath(),tt(this,rt),this},B=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,arguments[s],N);return this},Dt=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,arguments[s],0);return this},i=function(e){let s,t=arguments.length;for(K(),s=0;s<t;s++)$t.call(this,D,arguments[s]);return this},o=function(e){let s,t=arguments.length;for(s=0;s<t;s++)vt.call(this,0,arguments[s]);return this},f=function(e,s,t,n,h,d){let m,g=arguments,T=arguments.length;for(q(g,0,6,6),Z(this,e,t),this.ctx.bezierCurveTo(e,s,t,n,h,d),m=6;m<T;m+=6)this.ctx.bezierCurveTo(g[m],g[m+1],t=g[m+2],n=g[m+3],h=g[m+4],d=g[m+5]);return tt(h,d),X=[t,n],this},w=function(e,s,t,n,h,d){let m,g=arguments,T=g.length,H=D,j=N;for(q(g,0,6,6),K(),m=0;m<T;m+=6)this.ctx.bezierCurveTo(H+g[m],j+g[m+1],t=H+g[m+2],n=j+g[m+3],H+=g[m+4],j+=g[m+5]);return tt(H,j),X=[t,n],this},x=function(e,s,t,n){let h,d=arguments,m=d.length;for(q(arguments,0,4,4),Z(this,e,s),this.ctx.quadraticCurveTo(e,s,t,n),h=4;h<m;h+=4)this.ctx.quadraticCurveTo(e=d[h],s=d[h+1],t=d[h+2],n=d[h+3]);return tt(t,n),ot=[e,s],this},U=function(e,s,t,n){let h,d=arguments,m=d.length,g=D,T=N;for(q(arguments,0,4,4),K(),h=0;h<m;h+=4)this.ctx.quadraticCurveTo(e=g+d[h],s=T+d[h+1],g+=d[h+2],T+=d[h+3]);return tt(g,T),ot=[e,s],this},et=function(){if(!X)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=D,h=N,d=X[0],m=X[1],g,T,H,j,ht,at;for(q(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-d),H=h+(h-m),T=s[e],j=s[e+1],ht=s[e+2],at=s[e+3],this.ctx.bezierCurveTo(g,H,T,j,ht,at),n=ht,h=at,d=T,m=j;return tt(n,h),X=[d,m],this},bt=function(){if(!X)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=D,h=N,d=X[0],m=X[1],g,T,H,j,ht,at;for(q(arguments,0,4,4),K(),e=0;e<t;e+=4)g=n+(n-d),H=h+(h-m),T=n+s[e],j=h+s[e+1],ht=n+s[e+2],at=h+s[e+3],this.ctx.bezierCurveTo(g,H,T,j,ht,at),n=ht,h=at,d=T,m=j;return tt(n,h),X=[d,m],this},dt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments.length,t=D,n=N,h=ot[0],d=ot[1],m,g,T,H;for(q(arguments,0,2,2),K(),e=0;e<s;e+=2)m=t+(t-h),g=n+(n-d),T=arguments[e],H=arguments[e+1],this.ctx.quadraticCurveTo(m,g,T,H),t=T,n=H,h=m,d=g;return tt(t,n),ot=[h,d],this},pt=function(){if(!ot)throw new Error("Last command was not a cubic bezier");let e,s=arguments,t=s.length,n=D,h=N,d=ot[0],m=ot[1],g,T,H,j;for(q(arguments,0,2,2),K(),e=0;e<t;e+=2)g=n+(n-d),T=h+(h-m),H=n+arguments[e],j=h+arguments[e+1],this.ctx.quadraticCurveTo(g,T,H,j),n=H,h=j,d=g,m=T;return tt(n,h),ot=[d,m],this},mt=function(e,s,t,n,h,d,m){if(!e||!s)return $t.call(this,d,m);n=!!n,h=!!h,K();let g=D,T=N,H=d,j=m,ht=t*E,at=O(ht),Tt=I(ht),St=(g-H)/2,Nt=(T-j)/2,At=Tt*St+at*Nt,It=-at*St+Tt*Nt,Gt,Lt,Ot,Bt,Jt,Ut,jt,Mt;if(e=R(e),s=R(s),Gt=At*At/(e*e)+It*It/(s*s),Gt>1)e*=_(Gt),s*=_(Gt),Lt=Ot=0;else{let Vt=e*e,Kt=s*s,Qt=At*At,Zt=It*It,Rt=Vt*Zt+Kt*Qt;Rt=_(Vt*Kt/Rt-1),n===h&&(Rt=-Rt),Lt=Rt*e*It/s,Ot=-Rt*s*At/e}return Bt=Tt*(Lt-at)*(Ot+(g+H)/2),Jt=at*(Lt+Tt)*(Ot+(T+j)/2),St=(At-Lt)/e,Nt=(It-Ot)/s,Ut=Ct(1,0,St,Nt),Mt=Ct(St,Nt,(-At-Lt)/e,(-It-Ot)/s),h&&Mt<0?Mt+=S:!h&&Mt>0&&(Mt-=S),jt=Ut+Mt,this.ellipse(Bt,Jt,e,s,ht,Ut,jt,!h),this},ct=function(e,s,t,n,h,d,m){return K(),mt.call(this,e,s,t,n,h,d+D,m+N),this},G=function(e,s,t,n,h,d,m,g){h=h||0,d=d||0,m=m===L?S:m;let T=yt(t*I(d),n*O(d),h),H=e+T[0],j=s+T[1],ht=yt(t*I(m),n*O(m),h),at=e+ht[0],Tt=s+ht[1];return Z(this,H,j),this.ctx.translate(e,s),this.ctx.rotate(h),this.ctx.scale(t/n,1),this.ctx.arc(0,0,n,d,m,!!g),this.ctx.scale(n/t,1),this.ctx.rotate(-h),this.ctx.translate(-e,-s),tt(at,Tt),this},_t=function(){let e,s=arguments,t=s.length;if(t<6)throw new Error("not enough arguments");if(t%2===0)for(this.ctx.moveTo(s[0],s[1]),e=2;e<t;e+=2)this.ctx.lineTo(s[e],s[e+1]);else{let n=s[t-1],h=(t-1)/2,d=(s[h*2-2]+s[0])/2,m=(s[h*2-1]+s[1])/2,g,T;for(this.ctx.moveTo(d,m),e=0;e<h-1;e++)this.ctx.arcTo(g=s[e*2],T=s[e*2+1],s[e*2+2],s[e*2+3],n,d,m),d=g,m=T;this.ctx.arcTo(s[h*2-2],s[h*2-1],s[0],s[1],n,d,m)}return this},xt=function(e){let s=e.match(ft),t,n,h,d,m,g=[];if(!s)throw new Error("Bad path: "+e);for(d=0;t=s[d];d++){for(h=[],h.cmd=t.charAt(0),n=t.match(zt)||[],m=0;m<n.length;m++)h[m]=+n[m];g.push(h)}return g},Xt=p.extend({init:function(e){this.svgpath=xt(e),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(e){let s=this.svgpath,t,n;for(this.applyStyle(e),this.setTransform(e),e.beginPath(),c.setContext(e),t=0,n=s.length;t<n;t++)c[s[t].cmd].apply(c,s[t]);this.fill&&e.fill(),this.stroke&&e.stroke()}});return u(c,{distance:l,__zoom:1,Shape:p,setContext:function(e){return this.ctx=e,tt(0,0),e.beginPath(),this},polygon:_t,ellipse:G,M:kt,m:Pt,L:$t,l:vt,H:B,h:Dt,V:i,v:o,C:f,c:w,S:et,s:bt,Q:x,q:U,T:dt,t:pt,A:mt,a:ct,Z:Et,z:Et}),c.register("image",Q),c.register("circle",lt),c.register("arc",W),c.register("ellipse",F),c.register("rect",P),c.register("text",A),c.register("line",ut),c.register("path",Xt),c}function ie(c,v,C){let S=Object.prototype.toString,E="function",_="string",y="array",I="object",O=!1,Y=[],R=!1,M,L=c.G_vmlCanvasManager,k=/webkit|msie/i.exec(c.navigator.userAgent),V=navigator.userAgent,nt=V.match(/android/i),$=V.match(/iphone|ipad|ipod/i),b=V.match(/Windows Phone/i)||V.match(/iemobile/i),l=/^([#]?)([a-z][\w\-]*)$/,r=["","LEFT","CENTER","RIGHT"],a=[],u=null,p=null,P=!1,A="Cevent"+new Date().getTime(),z=0,Q={},F=function(i,o){return S.call(i).slice(8,-1).toLowerCase()===o},W=function(i,o){let f,w=0;if(F(i,y))for(;(f=i[w++])&&o(f,w)!==!1;);},lt=function(i,o){let f=ot(i,o);return f>=0?(i.splice(f,1),o):null},ut={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},D=function(i){return i=i||c.event,i.preventDefault||(i.preventDefault=function(){this.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){this.cancelBubble=!0}),i},N=function(i,o){let f=ut[o];return f?function(w){let x=w.type===f;M=B.isTouchDevice=x,!(!x&&(nt||$||b))&&i.call(this,w)}:i},rt=function(i){return document.getElementById(i)},X=function(){return document.addEventListener?function(o,f,w){o&&(o=typeof o=="string"?rt(o):o,w=N(w,f),ut[f]&&o.addEventListener(ut[f],w,!0),o.addEventListener(f,w,!0))}:function(o,f,w){o&&(o=typeof o=="string"?rt(o):o,o.attachEvent("on"+f,function(x){return x=D(x),w.call(x.target||x.srcElement,x)}))}}(),ot=function(){return[].indexOf?function(i,o){return i.indexOf(o)}:function(i,o){for(let f=0,w=i.length;f<w;f++)if(o===i[f])return f;return-1}}(),wt=function(i){let o=0,f=0;if(i.offsetParent)do o+=i.offsetLeft,f+=i.offsetTop;while(i=i.offsetParent);return{x:o,y:f}},ft=function(i,o,f){let w=i[A],x;return w||(w=i[A]=++z),x=Q[w],x||(x=Q[w]={}),o&&f!==C&&(x[o]=f),o?x[o]:x},zt=function(i,o){if(!i)return;let f=i[A];f&&Q[f]&&delete Q[f]},Ct=function(i,o,f){let w=ft(i),x;W(o.split(" "),function(U){x=w[U]=w[U]||[],x.push(f)})},yt=function(i,o,f,w){let x,U=0,et=!0;for(f.ctx.save(),f.ctx.scale(f.__zoom,f.__zoom);x=o[U++];)x.call(i,f,w)===!1&&(et=!1);return f.ctx.restore(),et||w.preventDefault(),et},Z=function(i,o,f,w){let x=ft(i,o),U=ft(w.cv,o);x&&x.length&&a.push(i,x),U&&U.length&&a.push(i,U)},tt=function(i,o){let f,w;for(i.clear(),f=0,w=a.length;f<w;f+=2)yt(a[f],a[f+1],i,o);a=[],i.redraw()},K=function(i,o){i.preventDefault(),i=i.touches?i.touches[0]:i;let f,w=o._shapes,x=w.length;for(o.x=((i&&i.pageX-o._pos.x+1||c.event.offsetX+1)-1)/o.__zoom||0,o.y=((i&&i.pageY-o._pos.y+1||c.event.offsetY+1)-1)/o.__zoom||0;f=w[--x];)if(f.hitTest(o))return f},q=function(i,o){return function(f){f.preventDefault(),f=f.touches?f.touches[0]:f,i.lastX=i.x,i.lastY=i.y,o=i._curHover;let w=((f&&f.pageX-i._pos.x+1||c.event.offsetX+1)-1)/i.__zoom||0,x=((f&&f.pageY-i._pos.y+1||c.event.offsetY+1)-1)/i.__zoom||0;if(!(!R&&Math.abs(w-i.x)<2&&Math.abs(x-i.y)<2)){if(i.x=w,i.y=x,R=!0,!i._clicked&&O){let U=K(f,i);U?(o!==U&&(Z(U,"mouseover",f,i),o&&Z(o,"mouseout",f,i)),i._curHover=o=U):o&&(Z(o,"mouseout",f,i),i._curHover=o=null)}o&&Z(o,"mousemove",f,i),a.length&&tt(i,f)}}},kt=function(i){return function(o){(o.type==="mousedown"||o.type==="touchstart")&&i.calcCanvasPosition(),O||(i._curHover=K(o,i)),i._curHover;let f=i._curHover,w=r[o.which||o.button];i._clicked=!0,u=i.cv,i[w]=!0,f?(Z(f,"mousedown",o,i),f!==i.focused&&(Z(f,"focus",o,i),i.focused&&Z(i.focused,"blur",o,i))):i.focused&&(Z(i.focused,"blur",o,i),i.focused=null),i.focused=f||null,a.length&&tt(i,o),i[w]=!1}},Pt=function(i){return function(o){i._clicked=!1,i._curHover&&(Z(i._curHover,"mouseup",o,i),!R&&M&&(Z(i._curHover,"tap",o,i),i.lastClick&&o.timeStamp-i.lastClick<300&&Z(i._curHover,"dblclick",o,i),i.lastClick=o.timeStamp)),R=!1,a.length&&tt(i,o)}},$t=function(i){return function(o){i._curHover&&Z(i._curHover,"click",o,i),a.length&&tt(i,o)}},vt=function(i){return function(o){i._curHover&&Z(i._curHover,"dblclick",o,i),a.length&&tt(i,o)}},Et=function(){let i={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},o;return function(f,w){let x=ft(w.cv,f,{}),U=ft(x);return function(et){if(u!==w.cv&&!w.__globalkeyevents)return;o=f=="keydown"?et.keyCode:o;let bt=i.specialKeys[o],dt=bt||String.fromCharCode(o||et.charCode).toLowerCase(),pt="",mt;if(et.altKey&&(pt+="alt+"),(et.ctrlKey||et.metaKey)&&(pt+="ctrl+"),et.shiftKey&&(pt+="shift+"),mt=U[pt+dt]||U[pt+i.shiftNums[dt]]||pt==="shift+"&&U[i.shiftNums[dt]]||U.any,mt){let ct=yt(w,mt,w,et);return w.play||w.redraw(),ct}}}}(),B=function(i,o){if(i=F(i,_)?v.getElementById(i):i,i.getContext||c.G_vmlCanvasManager)return new B.fn.init(i,o);throw Error("Your browser sucks")};B.forse_redraw=function(){let i,o=Y.length;for(i=0;i<o;i++)Y[i].redraw()},B.fn=B.prototype={init:function(i,o){this.cv=i,c.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#333",!i.getContext&&c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),this.ctx=i.getContext("2d"),this.width=i.width,this.height=i.height,this.__zoom=1,this.x=0,this.y=0,this.cv[A]?(this._shapes=ft(i,"shapes"),this._last=o):(Y.push(this),this._shapes=ft(i,"shapes",[]),this.__cache=ft(i,"cache",document.createElement("canvas")),this._last=null,c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),X(i,"mousemove",q(this),!1),X(i,"dblclick",vt(this),!1),X(i,"click",$t(this),!1),X(i,"mouseup",Pt(this),!1),X(i,"mousedown",kt(this),!1),X(v,"keydown",Et("keydown",this),!1),X(v,"keyup",Et("keyup",this),!1),k||X(v,"keypress",Et("keypress",this),!1),"onselectstart"in i&&(i.onselectstart=function(){return!1},i.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,lt(this._shapes,p),this.draw(),this._shapes.push(p),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=wt(this.cv),this},get:function(i){return i=i<0?this._shapes.length+i:i,this._shapes[i]||this._shapes},getAll:function(i){let o=[],f=l.exec(i),w,x;return i==="*"?o=this._shapes.slice(0):f&&(w=f[1],x=f[2],W(this._shapes,function(U){U[w]===x&&o.push(U)})),o},remove:function(i){return zt(lt(this._shapes,i)),this.redraw()},addId:function(i){let o=l.exec(i),f=this._last;return o&&!o[1]&&f&&(f.length?W(f,function(w){w["#"]=i}):f["#"]=i),this},removeId:function(){let i=this._last;return i&&!i.length?i["#"]="":W(i,function(o){o["#"]=""}),this},find:function(i){let o=this.getAll(i);return B(this.cv,o.length===1?o[0]:o)},attr:function(i,o){let f=this._last;return f&&f.attr?f.attr(i,o):W(f,function(w){w.attr(i,o)}),this},rotate:function(i){return this.attr({rotation:i})},translate:function(i,o){return this.attr({tx:i,ty:o})},scale:function(i,o){return this.attr({scaleX:i,scaleY:o})},skewX:function(i){return this.attr({skewX:i})},skewY:function(i){return this.attr({skewY:i})},zoomTo:function(i){return F(i,"number")&&(this.__zoom=i),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(i){return this.__globalkeyevents=!!i,this},bind:function(i,o,f){let w=f||this._last,x;if(!O&&"mouseover mouseout".indexOf(i)!==-1&&(O=!0),F(i,_)&&F(o,I))for(x in o)this[x](i,o[x]);else if(F(i,I))for(x in i)this[x](i[x]);else w&&!w.length?Ct(w,i,o):W(w,function(U){Ct(U,i,o)});return this},beforeDraw:function(i){return F(i,E)&&(this.__beforeDraw=i),this},afterDraw:function(i){return F(i,E)&&(this.__afterDraw=i),this},clear:function(i,o,f,w){return i=i||0,o=o||0,f=f||this.cv.width,w=w||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(i,o,f,w),this},draw:function(){let i,o=0,f=this._shapes;if(this.ctx.save(),B.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!L&&this.__cache&&P&&!this.play&&p)this.ctx.drawImage(this.__cache,0,0),p.draw(this.ctx);else for(;i=f[o++];)i.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),B.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},frameCount:0,stop:function(){return delete this.play,this}},B.fn.init.prototype=B.prototype,B.addEventListener=X;function Dt(i,o){let f=l.exec(i);return function(w,x){(f&&this[f[1]]===f[2]||i==="*")&&o.call(this,w,x)}}return W("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(i){B.fn[i]=function(o,f){let w;return F(f,E)&&(o=Dt(o,f),w=this.cv),this.bind(i,o,w)}}),W("keydown keypress keyup".split(" "),function(i){B.fn[i]=function(o,f){return!f&&F(o,E)&&(f=o,o="any"),o=(o+"").toLowerCase(),this.bind(o,f,ft(this.cv,i))}}),k&&(B.fn.keypress=B.fn.keydown),B.fn.drag=function(i){let o,f,w,x,U=[],et,bt="Cevent-drag"+A,dt=this._last;if(F(i,_)&&(et=i,i=arguments[1]),i&&(o=i.start,f=i.move,w=i.end,x=i.afterMove),et)return this.mousedown(et,pt).mouseup(et,ct).mousemove(et,mt);dt&&!dt.length&&(dt=[dt]),W(dt,function(G){ft(G,bt)||(ft(G,bt,!0),U.push(G))}),B(this.cv,U).mousedown(pt).mouseup(ct).mousemove(mt);function pt(G,_t){(G.LEFT||M)&&(p=this,!G.play&&!L&&!P&&G.updateCache())}function mt(G,_t){if(this===p){if(!P){if(o&&o.call(this,G,_t)===!1)return p=P=null;P=!0}f&&f.call(this,G,_t),this.rmove(G.x-G.lastX,G.y-G.lastY),x&&x.call(this,G,_t)}}function ct(G,_t){this===p&&(p=P=null,w&&w.call(this,G,_t))}return this},B.registre=B.register=function(i,o){i=i.toLowerCase();let f=i.charAt(0).toUpperCase()+i.substring(1);this[f]=o,this.prototype[i]=function(){let w=o.apply(this,arguments);return w[""]=i,this._shapes.push(w),this._last=w,this}},X(v,"mousedown",function(i){let o=i.target||i.srcElement;o=o.nodeName==="OBJECT"?o.parentNode:o,o[A]||(u=o)},!1),B.isTouchDevice=M,c.Cevent=B,B}const gt=ee(ie(window,document)),J=function(c){const v={randint:function(_){return~~(Math.random()*_)}};"bind"in Function||(Function.prototype.bind=function(_){let y=this;return function(){return y.apply(_,arguments)}});let C=Ht.extend({init:function(_){this.elem=document.getElementById(_)}}),S=function(_,y,I){return document.addEventListener?function(O,Y,R){O.addEventListener(Y,R,!1)}:function(O,Y,R){O.attachEvent("on"+Y,function(M){return M=M||y,M.preventDefault=M.preventDefault||function(){this.returnValue=!1},M.stopPropagation=M.stopPropagation||function(){this.cancelBubble=!0},R.call(M.target||M.srcElement,M)})}}(),E="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let _=0;_<E.length;_++){let y=E[_];C.prototype[y]=function(I){return function(O,Y){typeof O=="function"?S(this.elem,I,O):S(this.elem,I,function(R){let M=R.target||R.srcElement;M.tagName.toLowerCase()===O&&(R.stopPropagation(),Y.call(M,R))},!1)}}(y)}return v.fullScreen=function(){document.documentElement.scrollHeight<c.outerHeight/c.devicePixelRatio?(document.body.style.height=c.outerHeight/c.devicePixelRatio+1+"px",setTimeout(function(){c.scrollTo(1,1)},0)):c.scrollTo(1,1)},v.getContext=function(_){return!_.getContext&&c.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(_),_.getContext("2d")},v.extend=function(_,y){let I;for(I in y)y.hasOwnProperty(I)&&!(I in _)&&(_[I]=y[I]);return _},v.calcPieces=function(_){let y=_.image.width,I=_.image.height,O=document.getElementById("set-parts"),Y,R;O.innerHTML="";for(let M=0;M<_.options.length;M+=1){let L=~~Math.sqrt(y*I/_.options[M]),k=~~(y/L),V=~~(I/L);for(;k*V<_.options[M];)L--,k=~~(y/L),V=~~(I/L);R!==k*V&&(R=k*V,Y=document.createElement("option"),Y.value=_.options[M],Y.innerHTML=_.template.replace("%d",R),O.appendChild(Y),_.options[M]===_.selected&&(Y.selected=!0))}},v.addEvent=S,v.$=function(){let _=C();return function(y){return _.elem=document.getElementById(y),_}}(),v.getElement=function(_){return document.getElementById(_)},v.ajax=function(_){let y=new XMLHttpRequest;y.onreadystatechange=function(){y.readyState===XMLHttpRequest.DONE&&(y.status===200?_.success&&_.success(y.responseText):_.error&&_.error())},y.open("GET",_.url,!0),y.send()},c.Util=c.Util||v,v}(window),st=function(){};st.prototype.setMaxListeners=function(c){this._events||(this._events={}),this._events.maxListeners=c};Array.isArray=Array.isArray||function(c){return c.sort&&c.length&&c.slice};st.prototype.emit=function(c){if(c==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let v=this._events[c];if(!v)return!1;if(typeof v=="function"){switch(arguments.length){case 1:v.call(this);break;case 2:v.call(this,arguments[1]);break;case 3:v.call(this,arguments[1],arguments[2]);break;default:let C=Array.prototype.slice.call(arguments,1);v.apply(this,C)}return!0}if(Array.isArray(v)){let C=Array.prototype.slice.call(arguments,1),S=v.slice();for(let E=0,_=S.length;E<_;E++)S[E].apply(this,C);return!0}return!1};st.prototype.publish=st.prototype.emit,st.prototype.addListener=function(c,v){if(typeof v!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",c,v),!this._events[c])this._events[c]=v;else if(Array.isArray(this._events[c])){if(this._events[c].push(v),!this._events[c].warned){let C;this._events.maxListeners!==void 0?C=this._events.maxListeners:C=10,C&&C>0&&this._events[c].length>C&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),console.trace())}}else this._events[c]=[this._events[c],v];return this};st.prototype.on=st.prototype.subscribe=st.prototype.addListener,st.prototype.once=function(c,v){function C(){S.removeListener(c,C),v.apply(this,arguments)}if(typeof v!="function")throw new Error(".once only takes instances of Function");let S=this;return C.listener=v,S.on(c,C),this};st.prototype.removeListener=function(c,v){if(typeof v!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[c])return this;let C=this._events[c];if(Array.isArray(C)){let S=-1;for(let E=0,_=C.length;E<_;E++)if(C[E]===v||C[E].listener&&C[E].listener===v){S=E;break}if(S<0)return this;C.splice(S,1),C.length==0&&delete this._events[c]}else(C===v||C.listener&&C.listener===v)&&delete this._events[c];return this};st.prototype.unsubscribe=st.prototype.removeListener,st.prototype.removeAllListeners=function(c){return arguments.length===0?(this._events={},this):(c&&this._events&&this._events[c]&&(this._events[c]=null),this)};st.prototype.listeners=function(c){return this._events||(this._events={}),this._events[c]||(this._events[c]=[]),Array.isArray(this._events[c])||(this._events[c]=[this._events[c]]),this._events[c]};st.mixin=function(c){for(let v in st.prototype)c.prototype[v]||(c.prototype[v]=st.prototype[v])};function it(){return window.devicePixelRatio||1}(function(c,v,C){let S=J.getContext(c.createElement("canvas")),E=Math.abs,_=Math.PI/180,y=J.getContext(c.createElement("canvas")),I=navigator.userAgent,O=I.match(/android/i),Y=I.match(/iphone|ipad|ipod/i),R=I.match(/Windows Phone/i)||I.match(/iemobile/i),M=!O&&!Y&&!R,L=20;function k(l,r){if(l.rotation%360||r.rotation%360||r.hide||l.hide||l.row!=r.row&&l.col!=r.col)return;let a=l.tx-r.tx,u=l.ty-r.ty,p=l.col-r.col,P=l.row-r.row,A=l.width,z=l.height;if(l.size,(p==-1&&a<0&&E(a+A)<L||p==1&&a>=0&&E(a-A)<L)&&u<=L&&u>=-20)return[l.col>r.col?-E(a)+A:E(a)-A,r.ty-l.ty];if((P==-1&&u<0&&E(u+z)<L||P==1&&u>=0&&E(u-z)<L)&&a<=L&&a>=-20)return[r.tx-l.tx,l.row>r.row?-E(u)+z:E(u)-z]}let V=gt.Shape.extend({type:"piece",init:function(l,r,a,u,p,P,A){this.flat=A,this._super(l,r),this.img=a,this.originalImg=a,this.size=Math.max(u,p),this.width=u,this.height=p,this.diagonal=~~Math.sqrt(u*u+p*p),this.edges=P,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(l){let r=this.size,a,u=0;for(l.beginPath(),l.moveTo(this.x,this.y);u<4;u++){a=this.edges[u],r=u%2?this.height:this.width;let p=u%2?this.height:this.width,P=u%2?this.width:this.height,A=u%2?this.y:this.x,z=u%2?this.x:this.y;a?this[a](l,p,P,A,z):l.lineTo(A+r,z),l.rotate(Math.PI/2)}l.closePath()},render:function(l,r){l=l||this.ox||0,r=r||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let a=this.ctx||J.getContext(c.createElement("canvas")),u=this.size+.5;y.canvas.width=a.canvas.width=u*2,y.canvas.height=a.canvas.height=u*2,y.save(),a.save(),this.applyStyle(a),y.lineWidth=.5,a.lineWidth=.5,a.translate(this.width,this.height),a.rotate(this.rotation*_),y.translate(this.width,this.height),y.rotate(this.rotation*_),this.draw_path(a),this.draw_path(y),a.fill(),y.drawImage(this.originalImg,-this.originalTX-l,-this.originalTY-r),this.stroke&&(y.globalCompositeOperation="lighter",y.shadowOffsetY=1.5,y.shadowOffsetX=1.5,y.shadowBlur=0,y.shadowColor="rgba(255, 255, 255, .4)",y.lineWidth=1.5,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.globalCompositeOperation="darken",y.shadowBlur=1,y.shadowOffsetY=-1,y.shadowOffsetX=-1,y.shadowBlur=2,y.shadowColor="rgba(0, 0, 0, .2)",y.lineWidth=2,y.strokeStyle="rgba(0, 0, 0, .4)",y.stroke(),y.clip()),y.restore(),a.restore(),a.globalCompositeOperation="source-in",a.globalCompositeOperation!=="source-in"&&(a.globalCompositeOperation="source-atop"),a.drawImage(y.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=a.canvas,this.ctx=a,this.ox=l,this.oy=r},outside:function(l,r,a,u,p){if(this.flat)return l.lineTo(u+r,p);l.lineTo(u+r*.34,p),l.bezierCurveTo(u+r*.5,p,u+r*.4,p+a*-.15,u+r*.4,p+a*-.15),l.bezierCurveTo(u+r*.3,p+a*-.3,u+r*.5,p+a*-.3,u+r*.5,p+a*-.3),l.bezierCurveTo(u+r*.7,p+a*-.3,u+r*.6,p+a*-.15,u+r*.6,p+a*-.15),l.bezierCurveTo(u+r*.5,p,u+r*.65,p,u+r*.65,p),l.lineTo(u+r,p)},inside:function(l,r,a,u,p){if(this.flat)return l.lineTo(u+r,p);l.lineTo(u+r*.35,p),l.bezierCurveTo(u+r*.505,p+.05,u+r*.405,p+a*.155,u+r*.405,p+a*.1505),l.bezierCurveTo(u+r*.3,p+a*.3,u+r*.5,p+a*.3,u+r*.5,p+a*.3),l.bezierCurveTo(u+r*.7,p+a*.29,u+r*.6,p+a*.15,u+r*.6,p+a*.15),l.bezierCurveTo(u+r*.5,p,u+r*.65,p,u+r*.65,p),l.lineTo(u+r,p)},draw:function(l){if(this.hide)return;let r=this.x-this.width/2-.5,a=this.y-this.height/2-.5;if(M){this.setTransform(l),l.drawImage(this.img,r,a);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),l.drawImage(this.img,r+this.tx,a+this.ty)},check:function(l){let r;if(l.type==="piece")r=k(this,l);else{let a,u=l.pieces.length;for(a=0;a<u&&!(r=k(this,l.pieces[a]));a++);}return r&&this.rmove(r[0],r[1]),r},hitTest:function(l){if(!this.hide)return this.setTransform(S),this.draw_path(S),S.isPointInPath(l.x*it(),l.y*it())}}),nt=gt.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(l){if(this.hide)return;let r,a=this.pieces.length;for(r=0;r<a;r++)this.pieces[r].draw(l)},hitTest:function(l){let r,a=this.pieces.length;for(r=0;r<a;r++)if(this.pieces[r].hitTest(l))return!0},check:function(l){let r,a=this.pieces.length,u;if(l.type==="piece"){for(r=0;r<a;r++)if(u=k(this.pieces[r],l))return this.rmove(u[0],u[1]),!0}else{let p,P=l.pieces.length;for(r=0;r<a;r++)for(p=0;p<P;p++)if(u=k(this.pieces[r],l.pieces[p]))return this.rmove(u[0],u[1]),!0}},rmove:function(l,r){let a,u=this.pieces.length;for(a=0;a<u;a++)this.pieces[a].rmove(l,r);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=b(this.pieces,"tx"),this.minPieceY=b(this.pieces,"ty"),this.width=$(this.pieces,"tx").tx-this.minPieceX.tx,this.height=$(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function $(l,r){let a=l[0][r],u=0;for(let p=1;p<l.length;p++)l[p][r]>a&&(a=l[p][r],u=p);return l[u]}function b(l,r){let a=l[0][r],u=0;for(let p=1;p<l.length;p++)l[p][r]<a&&(a=l[p][r],u=p);return l[u]}gt.register("group",nt),gt.register("piece",V)})(document);const Yt=function(c,v,C){let S="inside",E="outside",_=null,y,I=[S,E],O=0,Y={spread:.7,offsetTop:0,maxWidth:v.innerWidth,maxHeight:v.innerHeight,defaultImage:"images/puzzle/scottwills_meercats.jpg",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:10,shuffled:!1,rotatePieces:!0,numberOfPieces:[10,20,30,40,50,60,70,80,90,100],squarePieces:!1},R=45,M=it();function L(){return I[J.randint(2)]}let k={};k.Jigsaw=Ht.extend({init:function($){let b=new st,l=this;this.container=c.body,this.opts=$=J.extend($||{},Y),this.max_width=$.maxWidth,this.max_height=$.maxHeight,J.$("redirect-form").action=$.redirect,y=$.defaultImage,this.eventBus=b,this.ce=new gt("canvas"),this.ui=new k.UI(b,$.defaultPieces||10),this.tmp_img=c.createElement("img"),this.img=c.getElementById("image"),this.ctx=J.getContext(this.img),this.preview=c.getElementById("image-preview"),this.previewCtx=J.getContext(this.preview),this.parts=$.defaultPieces||10,this.tmp_img.onload=function(){l.original=this,l.draw_image(this),J.calcPieces({image:l.img,template:l.opts.piecesNumberTmpl,selected:l.parts,options:l.opts.numberOfPieces}),l.render()},this.tmp_img.onerror=function(){y&&l.set_image(y)},V(this.ce,b,this.opts.rotatePieces),b.on(k.Events.JIGSAW_COMPLETE,function(){l.ui.stop_clock(),$.redirect?l.redirect():l.ui.show_time()}),$.shuffled&&b.on(k.Events.RENDER_FINISH,this.shuffle.bind(this)),b.on(k.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),b.on(k.Events.RENDER_REQUEST,this.render.bind(this)),b.on(k.Events.JIGSAW_SHUFFLE,this.shuffle.bind(this)),b.on(k.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),b.on(k.Events.SHOW_EDGE,function(){l.ce.find("#middle").attr("hide",!0),l.ce.find("#edge").attr("hide",!1),l.ce.redraw()}),b.on(k.Events.SHOW_MIDDLE,function(){l.ce.find("#middle").attr("hide",!1),l.ce.find("#edge").attr("hide",!0),l.ce.redraw()}),b.on(k.Events.SHOW_ALL,function(){l.ce.find("*").attr("hide",!1),l.ce.redraw()}),J.addEvent(v,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){let b=this.ce.cv,l=this.width(),r=this.height()-R;b.width=l*it(),b.height=r*it(),b.style.width=l+"px",b.style.height=r+"px",this.ce.redraw(),gt.isTouchDevice&&J.fullScreen()},redirect:function(){J.$("t").value=this.ui.time(),J.$("p").value=this.parts,J.$("redirect-form").submit()},set_parts:function($){this.parts=$},set_image:function($){this.ce.cv.className="loading",this.tmp_img.src=$||y},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function($,b,l){let r=b||this.max_width*it(),a=l||this.max_height*it(),u,p,P=this.ctx;if(r>this.width()||a>this.height()-R){let A=Math.min(this.width()/r,(this.height()-R)/a);r*=A,a*=A}if($.width>r||$.height>a){let A=Math.min(r/$.width,a/$.height);u=~~($.width*A)*it(),p=~~($.height*A)*it(),P.canvas.width=u,P.canvas.height=p,P.drawImage($,0,0,$.width,$.height,0,0,u,p)}else P.canvas.width=$.width*it(),P.canvas.height=$.height*it(),P.drawImage($,0,0,$.width,$.height,0,0,P.canvas.width,P.canvas.height)},clear:function(){this.ce._shapes=[]},shuffle:function(){let $=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=$=this.__pieces.slice(0);else return;this.ce.clear();let b,l=$.length,r;$[0].size;let a=this.opts.spread,u=this.width()*it(),p=(this.height()-R)*it(),P=u*a,A=p*a,z=~~((u-P)/2),Q=~~((p-A)/2);for(b=0;b<l;b++)r=$[b],r.tx=J.randint(P)+r.tx%1+z,r.ty=J.randint(A)+r.tx%1+Q,this.opts.rotatePieces&&(r.rotation=J.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",this.ce.shuffled=!1;let $,b,l,r,a=[],u=[],p=this.img.width,P=this.img.height,A=~~Math.sqrt(p*P/this.parts),z=~~(p/A),Q=~~(P/A),F=0,W=0,lt=++O,ut;for(this.flag=lt;z*Q<this.parts;)A--,z=~~(p/A),Q=~~(P/A);let D=~~(p/z),N=~~(P/Q);D=D%2?D:D-1,N=N%2?N:N-1,ut=~~(this.width()/2*it()-D*z/2),this.clear();let rt=~~((p-z*D)/2),X=~~((P-Q*N)/2);rt=rt>=0?rt:0,X=X>=0?X:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=D*z,this.preview.height=N*Q,this.preview.style.width=this.preview.width/it()+"px",this.preview.style.height=this.preview.height/it()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,rt,X,D*z,N*Q,0,0,D*z,N*Q),(function ot(){if(F<z&&lt===this.flag){W<Q?($=W===0?_:l===S?E:S,b=F===z-1?_:L(),l=W===Q-1?_:L(),r=F===0?0:u[W]===S?E:S,this.ce.piece(D*F,N*W+this.opts.offsetTop,v.G_vmlCanvasManager?this.tmp_img:this.img,D,N,[$,b,l,r],this.opts.squarePieces).attr({col:F,row:W,offset:ut,stroke:this.opts.border?"black":""}).get(-1).render(rt,X-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),W===0||F===0||F===z-1||W===Q-1?this.ce.addId("edge"):this.ce.addId("middle"),a.push(b),W++):(F++,W=0,u=a,a=[]),setTimeout(ot.bind(this),20);return}else this.flag===lt&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(k.Events.RENDER_FINISH))}).bind(this)()}}),k.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",JIGSAW_SHUFFLE:"JigsawShuffleEvent",SHOW_PREVIEW:"JigsawShowPreview",SHOW_HELP:"JigsawShowHelp",SHOW_FILEPICKER:"JigsawShowFilepicker",SHOW_EDGE:"ShowEdgeEvent",SHOW_MIDDLE:"ShowMiddleEvent",SHOW_ALL:"ShowAllEvent",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent"},k.GET=function(){if(location.query)return;let $=location.search.replace(/^[?]/,"").split("&"),b=0,l=$.length,r={};for(;b<l;b++){if(!$[b])continue;let a=$[b].split("=");r[unescape(a[0])]=unescape(a[1])}return r},k.UI=Ht.extend({init:function($,b){this.eventBus=$,this.clock=J.$("clock"),nt(this,$),$.on(k.Events.JIGSAW_SHUFFLE,this.init_clock.bind(this)),$.on(k.Events.SHOW_PREVIEW,this.show_preview.bind(this)),$.on(k.Events.SHOW_HELP,this.show_help.bind(this)),$.on(k.Events.SHOW_FILEPICKER,this.show_filepicker.bind(this))},stop_clock:function(){O++},init_clock:function(){let $=this;this.ini=new Date().getTime(),this.uuid=O,function b(){$.uuid===O&&($.clock.innerHTML=$.time(),setTimeout(b,1e3))}()},show_preview:function(){let $=J.getElement("image-preview");$.className=$.className==="show"?"hide":"show",$.style.marginLeft=-($.width/2/M)+"px"},show_time:function(){this.show_modal("congrat"),J.getElement("time").innerHTML=this.clock.innerHTML,J.getElement("time-input").value=this.clock.innerHTML},time:function(){let $=~~((new Date().getTime()-this.ini)/1e3),b=$%60,l=~~($/60),r=~~(l/60);return l%=60,(r>9?r:"0"+r)+":"+(l>9?l:"0"+l%60)+":"+(b>9?b:"0"+b)},show_modal:function($){Wt.Modal.open($)},show_filepicker:function(){this.show_modal("create-puzzle")},show_help:function(){this.show_modal("help")}});function V($,b,l){$.drag("*",{start:function(r,a){r.cv.style.cursor="move",r.lastX*=it(),r.lastY*=it(),this.handleX=r.lastX-this.tx,this.handleY=r.lastY-this.ty},move:function(r,a){r.x*=it(),r.y*=it(),r.x+=r.lastX-this.tx-this.handleX,r.y+=r.lastY-this.ty-this.handleY},afterMove:function(r,a){let u=~~(this.width/2),p=~~(this.height/2),P=this.x+this.tx+u,A=this.y+this.ty+p,z=r.cv.width,Q=r.cv.height;this.rotation/45%2&&(u=this.diagonal/2,p=this.diagonal/2);let F=0,W=0;P-u<0?F=P-u:P+u>z&&(F=P+u-z),A-p<0?W=A-p:A+p>Q&&(W=A+p-Q),this.rmove(-F,-W)},end:function(r,a){if(r.cv.style.cursor="default",!r.shuffled)return;let u=r.getAll("piece").concat(r.getAll("group")),p=0,P=u.length,A=this;for(;p<P;p++)u[p]!==this&&A.check(u[p])&&(r.remove(A),r.remove(u[p]),r._curHover=r.group().get(-1),r._curHover.add(A.pieces||A,u[p].pieces||u[p]),A=r._curHover,r.focused=null);this!==A&&b.emit(k.Events.PIECES_CONNECTED),!$.getAll("piece").length&&$.getAll("group").length===1&&$.shuffled&&($.shuffled=!1,b.emit(k.Events.JIGSAW_COMPLETE)),A.type==="group"&&(r.remove(A),r._shapes.unshift(A))}}).focus("*",function(r,a){r.remove(this),r._shapes.push(this)}),J.addEvent($.cv,"contextmenu",function(r){l&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw()),r.preventDefault()}),l&&($.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),$.tap("*",function(r,a){gt.isTouchDevice&&$.focused&&($.focused.rotation=($.focused.rotation+45)%360,$.redraw())}))}function nt($,b){function l(a){let u=a[0];if(!u.type.match(/image.*/)){J.getElement("image-error").style.display="block";return}let p=new FileReader;p.onloadend=function(P){b.emit(k.Events.JIGSAW_SET_IMAGE,this.result),r()},p.readAsDataURL(u)}v.FileReader&&new FileReader().onload===null&&(J.getElement("create").style.display="block",J.$("image-input").change(function(){l(this.files)}),"ondragenter"in v&&"ondrop"in v&&(J.getElement("dnd").style.display="block",c.addEventListener("dragenter",function(a){return a.stopPropagation(),a.preventDefault(),!1},!1),c.addEventListener("dragover",function(a){return a.stopPropagation(),a.preventDefault(),!1},!1),c.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault();let u=a.dataTransfer;l(u.files)},!1)));function r(){return Wt.Modal.close(),!1}J.$("set-parts").change(function(){b.emit(k.Events.PARTS_NUMBER_CHANGED,+this.value),b.emit(k.Events.RENDER_REQUEST)}),gt.addEventListener("game-options","mousedown",function(a){let u=a.target||a.srcElement;k.Events[u.id]&&(a.preventDefault(),b.emit(k.Events[u.id]))})}return st.mixin(k.Jigsaw),k}(document,window),Wt=function(){let c=0,v=window.Audio&&new Audio().canPlayType,C=0,S=function(L){return document.getElementById(L)},E,_,y,I;function O(){E=S("modal-window"),_=S("modal-window-msg"),y=S("modal-window-close"),I=S("overlay");let L=gt.isTouchDevice?"touchstart":"click";gt.addEventListener(I,L,R),gt.addEventListener(y,L,R)}function Y(L,k){E||O();let V=E.style,nt=S(L);nt.className="",Wt.Modal.currentContent=nt,_.appendChild(nt);let $=E.offsetWidth;V.marginLeft=-$/2+"px",E.className="modal",I.className=""}function R(L){L&&L.preventDefault(),E.className="modal hide",I.className="hide";let k=Wt.Modal.currentContent;return setTimeout(function(){k&&(k.className="hide",document.body.appendChild(k))},600),!1}function M(L,k){if(!v)return;let V;for(this.file=L,C=k,this.audio=[],V=0;V<k;V++)this.audio[V]=new Audio;const nt=(function(){document.removeEventListener("touchstart",nt),document.removeEventListener("mousedown",nt),this.load()}).bind(this);document.addEventListener("touchstart",nt),document.addEventListener("mousedown",nt)}return M.prototype.load=function(){if(!v||this._loaded)return;this._loaded=!0;const L=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let k=0;k<C;k++)this.audio[k].src=this.file+L,this.audio[k].volume=0,this.audio[k].load()},M.prototype.play=function(){v&&(this.audio[c].volume=1,this.audio[c].play(),c=(c+1)%C)},{Sound:M,Modal:{open:Y,close:R}}}();window.addEventListener("DOMContentLoaded",function(){const c=new Wt.Sound("sound/click",10),v=new Yt.Jigsaw({defaultImage:"images/default-puzzle.png",piecesNumberTmpl:"%d Pieces",numberOfPieces:[10,20,30,40,50,60,70,80,90,100],defaultPieces:10});v.eventBus.on(Yt.Events.PIECES_CONNECTED,function(){c.play()}),Yt.GET.image&&v.set_image(Yt.GET.image)})});export default se();
