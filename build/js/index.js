(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))I(E);new MutationObserver(E=>{for(const v of E)if(v.type==="childList")for(const w of v.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&I(w)}).observe(document,{childList:!0,subtree:!0});function P(E){const v={};return E.integrity&&(v.integrity=E.integrity),E.referrerPolicy&&(v.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?v.credentials="include":E.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function I(E){if(E.ep)return;E.ep=!0;const v=P(E);fetch(E.href,v)}})();let Ut=!1;function Mt(){}Mt.extend=function(l){const g=this.prototype;let P;Ut=!0,P=new this,Ut=!1;for(let E in l)typeof l[E]=="function"&&typeof g[E]=="function"?P[E]=function(v,w){return function(){const A=this._super;this._super=g[v];const z=w.apply(this,arguments);return this._super=A,z}}(E,l[E]):P[E]=l[E];function I(){if(this instanceof I)!Ut&&this.init&&this.init.apply(this,arguments);else return new I(...arguments)}return I.prototype=P,I.prototype.constructor=I,I.extend=this.extend,I};function Zt(l){let g=Math,P=g.PI,I=2*P,E=P/180,v=g.sqrt,w=g.pow,A=g.cos,z=g.sin,G=g.round,D=g.abs,M=g.acos,O,C=Object.prototype.hasOwnProperty,J=Array.prototype.slice,it={tx:0,ty:0,scaleX:1,scaleY:1,skewX:0,skewY:0,fill:"#000",stroke:"",lineWidth:1,lineJoin:"miter",lineCap:"butt",alpha:1,rotation:0,composite:"source-over",shadowColor:"rgba(0, 0, 0, 0.0)",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,fontStyle:"normal",fontWeight:"normal",fontSize:10,fontFamily:"Arial"},p=document.createElement("canvas"),T=p.getContext&&p.getContext("2d"),o=function(t,i){return v(w(t.x-i.x,2)+w(t.y-i.y,2))},n=function(t,i,r,d,c){let y=r-t,_=d-i,b={},S;if(!(y===0&&_===0))return S=((c.x-t)*y+(c.y-i)*_)/(y*y+_*_),S<0?b={x:t,y:i}:S>1?b={x:r,y:r}:b={x:t+S*y,y:i+S*_},o(b,c)},h=function(t,i,r){return r=E*r,{x:t*A(r)-i*z(r),y:t*z(r)+i*A(r)}},u=function(t,i){let r;for(r in i)C.call(i,r)&&(t[r]=i[r])},f=Mt.extend({init:function(t,i){this.x=t||0,this.y=i||0,u(this,it)},position:function(){let t=h(this.x*this.scaleX,this.y*this.scaleY,this.rotation);return{x:t.x+this.tx,y:t.y+this.ty}},rmove:function(t,i){this.tx+=t,this.ty+=i},attr:function(t,i){let r;if(typeof t=="string")this[t]=i;else for(r in t)this[r]=t[r];return this},applyStyle:function(t){let i=this.shadowBlur,r=this.shadowOffsetX,d=this.shadowOffsetY;t.fillStyle=this.fill,t.globalAlpha=this.alpha,t.globalCompositeOperation=this.composite,this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.lineWidth),(r||d||i)&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=r,t.shadowOffsetY=d,t.shadowBlur=i)},setTransform:function(t){let i=l.__zoom,r=this.scaleX*i,d=this.scaleY*i,c=this.skewX*i,y=this.skewY*i,_=this.rotation*E,b=z(_),S=A(_),X=this.tx*i,V=this.ty*i,nt=S*r-b*y,rt=S*c-b*d,mt=b*r+S*y,wt=b*c+S*d;t.setTransform(nt,mt,rt,wt,X,V)},draw:function(t){throw new Error("El método draw no se ha implementado")},fill_or_stroke:function(t){this.fill&&t.fill(),this.stroke&&t.stroke()},hitTest:function(t){if(T&&T.isPointInPath)return this.draw(T),T.setTransform(1,0,0,1,0,0),T.isPointInPath(t.x,t.y);throw Error("Método isPointInPath no soportado: Necesita FlashCanvasPro")}}),L=f.extend({init:function(t,i,r,d,c){this.r=c||0,this.w=r||5,this.h=d||r,this._super(t,i)},draw:function(t){let i=this.x,r=this.y,d=this.w,c=this.h;this.applyStyle(t),this.setTransform(t),t.beginPath(),this.r?l.setContext(t).polygon(i,r,i+d,r,i+d,r+c,i,r+c,this.r):t.rect(i,r,G(d),G(c)),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()},hitTest:function(t){if(this.skewX||this.skewY||this.r)return this._super(t);let i=this.position(),r=h(t.x-i.x,t.y-i.y,-this.rotation);return r.x>=0&&r.x<=this.w*this.scaleX&&r.y>=0&&r.y<=this.h*this.scaleY}}),k=L.extend({init:function(t,i,r){this.setText(r),this._super(t,i,this.w,this.h)},applyStyle:function(t){t.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.h=this.fontSize,this.w=t.measureText(this.text).width,this._super(t)},setText:function(t){this.text=t+""},draw:function(t){this.applyStyle(t),this.setTransform(t),this.fill&&t.fillText(this.text,this.x,this.y+this.h),this.stroke&&t.strokeText(this.text,this.x,this.y+this.h)},hitTest:function(t){return this.skewX||this.skewY&&T&&T.isPointInPath?(this.setTransform(T),T.beginPath(),T.rect(this.x,this.y,this.w,this.h),T.closePath(),T.isPointInPath(t.x,t.y)):this._super(t)}}),N={},B=L.extend({init:function(t,i,r){this.setImg(r),this._super(t,i,this.img.width,this.img.height)},setImg:function(t){if(N[t]){this.img=N[t],this.src=this.img.src;return}t.nodeName=="IMG"?this.img=t:(t+="",this.img=N[t]=new Image,this.img.src=t),this.img.onload=function(){l.forse_redraw()},this.src=this.img.src},draw:function(t){let i=this.x,r=this.y;this.w=this.img.width,this.h=this.img.height,this.applyStyle(t),this.setTransform(t),t===T?(t.beginPath(),t.rect(i,r,G(this.w),G(this.h)),t.closePath()):t.drawImage(this.img,i,r)}}),st=L.extend({draw:function(t){let i=this.x,r=this.y,d=this.w,c=this.h,y=.5522847498307933,_=y*d,b=y*c;this.applyStyle(t),this.setTransform(t),t.beginPath(),t.moveTo(i+d,r),t.bezierCurveTo(i+d,r-b,i+_,r-c,i,r-c),t.bezierCurveTo(i-_,r-c,i-d,r-b,i-d,r),t.bezierCurveTo(i-d,r+b,i-_,r+c,i,r+c),t.bezierCurveTo(i+_,r+c,i+d,r+b,i+d,r),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()},hitTest:f.prototype.hitTest}),H=f.extend({init:function(t,i,r,d,c,y){this.clockwise=y,this.endAngle=c,this.startAngle=d,this.r=r,this._super(t,i)},draw:function(t){let i=this.x,r=this.y;this.applyStyle(t),this.setTransform(t),t.beginPath(),t.arc(i,r,G(this.r),this.startAngle||P*2,this.endAngle||0,!!this.clockwise),t.lineTo(i,r),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()}}),ot=f.extend({init:function(t,i,r){this.r=r||5,this._super(t,i)},draw:function(t){let i=this.x,r=this.y;this.applyStyle(t),this.setTransform(t),t.beginPath(),t.arc(i,r,G(this.r),0,P*2,!0),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()},hitTest:function(t){if(this.skewX||this.skewY||this.scaleX!==this.scaleY)return this._super(t);let i=!!this.stroke&&this.lineWidth,r=this.position();return o(t,r)<=(this.r+i)*this.scaleX}}),gt=f.extend({init:function(t,i,r,d){this.x2=r,this.y2=d,this._super(t,i),this.stroke="#000"},rmove:function(t,i){this.x+=t,this.y+=i,this.x2+=t,this.y2+=i},applyStyle:function(t){t.lineJoin=this.lineJoin,t.lineCap=this.lineCap,this._super(t)},draw:function(t){this.applyStyle(t),this.setTransform(t),t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x2,this.y2),t.stroke()},hitTest:function(t){return n(this.x,this.y,this.x2,this.y2,t)<=this.lineWidth+2}}),R,U,ut,K=null,q=null,It=!1,Wt=/[MmLlZzHhVvCcQqSsTtAa]\s*([\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?[,\s]*)*/g,ht=/[\-+]?(?:\d+[.]?\d*|[.]\d+)(?:[Ee][\-+]?\d+)?/g,Nt=function(t,i,r,d){let c=t*r+i*d,y=v(t*t+i*i),_=v(r*r+d*d),b=c/(y*_),S,X;return b>1?b=1:b<-1&&(b=-1),S=D(M(b)),X=t*d-i*r,X===D(X)?S:-S},Lt=function(t,i,r){return[t*A(r)-i*z(r),i*A(r)+t*z(r)]},vt=function(t,i,r){It&&t.ctx.moveTo(i,r)},W=function(t,i){R=t,U=i,K=null,q=null,It=!1},et=function(){if(R===O)throw new Error("No current point; can't use relative coordinates")},at=function(t,i,r,d){if(i!==(r?t.length%r:t.length)||t.length<d)throw new Error("wrong number of arguments")},Xt=function(t,i){return this.ctx.moveTo(t,i),W(t,i),ut=t,arguments.length>2&&_t.apply(this,J.call(arguments,2)),this},Gt=function(t,i){return It&&(R=U=0),et(),t+=R,i+=U,this.ctx.moveTo(t,i),W(t,i),ut=t,arguments.length>2&&Tt.apply(this,J.call(arguments,2)),this},_t=function(t,i){let r,d=arguments.length;for(at(arguments,0,2,2),vt(this,t,i),this.ctx.lineTo(t,i),r=2;r<d;r+=2)this.ctx.lineTo(t=arguments[r],i=arguments[r+1]);return W(t,i),this},Tt=function(t,i){let r,d=R,c=U,y=arguments.length;for(at(arguments,0,2,2),et(),r=0;r<y;r+=2)this.ctx.lineTo(d+=arguments[r],c+=arguments[r+1]);return W(d,c),this},Rt=function(){return this.ctx.closePath(),W(this,ut),this},At=function(t){let i,r=arguments.length;for(et(),i=0;i<r;i++)_t.call(this,arguments[i],U);return this},$=function(t){let i,r=arguments.length;for(i=0;i<r;i++)Tt.call(this,arguments[i],0);return this},Yt=function(t){let i,r=arguments.length;for(et(),i=0;i<r;i++)_t.call(this,R,arguments[i]);return this},e=function(t){let i,r=arguments.length;for(i=0;i<r;i++)Tt.call(this,0,arguments[i]);return this},s=function(t,i,r,d,c,y){let _,b=arguments,S=arguments.length;for(at(b,0,6,6),vt(this,t,r),this.ctx.bezierCurveTo(t,i,r,d,c,y),_=6;_<S;_+=6)this.ctx.bezierCurveTo(b[_],b[_+1],r=b[_+2],d=b[_+3],c=b[_+4],y=b[_+5]);return W(c,y),K=[r,d],this},a=function(t,i,r,d,c,y){let _,b=arguments,S=b.length,X=R,V=U;for(at(b,0,6,6),et(),_=0;_<S;_+=6)this.ctx.bezierCurveTo(X+b[_],V+b[_+1],r=X+b[_+2],d=V+b[_+3],X+=b[_+4],V+=b[_+5]);return W(X,V),K=[r,d],this},m=function(t,i,r,d){let c,y=arguments,_=y.length;for(at(arguments,0,4,4),vt(this,t,i),this.ctx.quadraticCurveTo(t,i,r,d),c=4;c<_;c+=4)this.ctx.quadraticCurveTo(t=y[c],i=y[c+1],r=y[c+2],d=y[c+3]);return W(r,d),q=[t,i],this},x=function(t,i,r,d){let c,y=arguments,_=y.length,b=R,S=U;for(at(arguments,0,4,4),et(),c=0;c<_;c+=4)this.ctx.quadraticCurveTo(t=b+y[c],i=S+y[c+1],b+=y[c+2],S+=y[c+3]);return W(b,S),q=[t,i],this},Y=function(){if(!K)throw new Error("Last command was not a cubic bezier");let t,i=arguments,r=i.length,d=R,c=U,y=K[0],_=K[1],b,S,X,V,nt,rt;for(at(arguments,0,4,4),et(),t=0;t<r;t+=4)b=d+(d-y),X=c+(c-_),S=i[t],V=i[t+1],nt=i[t+2],rt=i[t+3],this.ctx.bezierCurveTo(b,X,S,V,nt,rt),d=nt,c=rt,y=S,_=V;return W(d,c),K=[y,_],this},j=function(){if(!K)throw new Error("Last command was not a cubic bezier");let t,i=arguments,r=i.length,d=R,c=U,y=K[0],_=K[1],b,S,X,V,nt,rt;for(at(arguments,0,4,4),et(),t=0;t<r;t+=4)b=d+(d-y),X=c+(c-_),S=d+i[t],V=c+i[t+1],nt=d+i[t+2],rt=c+i[t+3],this.ctx.bezierCurveTo(b,X,S,V,nt,rt),d=nt,c=rt,y=S,_=V;return W(d,c),K=[y,_],this},bt=function(){if(!q)throw new Error("Last command was not a cubic bezier");let t,i=arguments.length,r=R,d=U,c=q[0],y=q[1],_,b,S,X;for(at(arguments,0,2,2),et(),t=0;t<i;t+=2)_=r+(r-c),b=d+(d-y),S=arguments[t],X=arguments[t+1],this.ctx.quadraticCurveTo(_,b,S,X),r=S,d=X,c=_,y=b;return W(r,d),q=[c,y],this},ft=function(){if(!q)throw new Error("Last command was not a cubic bezier");let t,i=arguments,r=i.length,d=R,c=U,y=q[0],_=q[1],b,S,X,V;for(at(arguments,0,2,2),et(),t=0;t<r;t+=2)b=d+(d-y),S=c+(c-_),X=d+arguments[t],V=c+arguments[t+1],this.ctx.quadraticCurveTo(b,S,X,V),d=X,c=V,y=b,_=S;return W(d,c),q=[y,_],this},lt=function(t,i,r,d,c,y,_){if(!t||!i)return _t.call(this,y,_);d=!!d,c=!!c,et();let b=R,S=U,X=y,V=_,nt=r*E,rt=z(nt),mt=A(nt),wt=(b-X)/2,Ot=(S-V)/2,yt=mt*wt+rt*Ot,Et=-rt*wt+mt*Ot,Ht,xt,kt,qt,$t,Ft,Jt,Pt;if(t=D(t),i=D(i),Ht=yt*yt/(t*t)+Et*Et/(i*i),Ht>1)t*=v(Ht),i*=v(Ht),xt=kt=0;else{let Bt=t*t,Vt=i*i,Qt=yt*yt,jt=Et*Et,St=Bt*jt+Vt*Qt;St=v(Bt*Vt/St-1),d===c&&(St=-St),xt=St*t*Et/i,kt=-St*i*yt/t}return qt=mt*(xt-rt)*(kt+(b+X)/2),$t=rt*(xt+mt)*(kt+(S+V)/2),wt=(yt-xt)/t,Ot=(Et-kt)/i,Ft=Nt(1,0,wt,Ot),Pt=Nt(wt,Ot,(-yt-xt)/t,(-Et-kt)/i),c&&Pt<0?Pt+=I:!c&&Pt>0&&(Pt-=I),Jt=Ft+Pt,this.ellipse(qt,$t,t,i,nt,Ft,Jt,!c),this},dt=function(t,i,r,d,c,y,_){return et(),lt.call(this,t,i,r,d,c,y+R,_+U),this},Ct=function(t,i,r,d,c,y,_,b){c=c||0,y=y||0,_=_===O?I:_;let S=Lt(r*A(y),d*z(y),c),X=t+S[0],V=i+S[1],nt=Lt(r*A(_),d*z(_),c),rt=t+nt[0],mt=i+nt[1];return vt(this,X,V),this.ctx.translate(t,i),this.ctx.rotate(c),this.ctx.scale(r/d,1),this.ctx.arc(0,0,d,y,_,!!b),this.ctx.scale(d/r,1),this.ctx.rotate(-c),this.ctx.translate(-t,-i),W(rt,mt),this},Z=function(){let t,i=arguments,r=i.length;if(r<6)throw new Error("not enough arguments");if(r%2===0)for(this.ctx.moveTo(i[0],i[1]),t=2;t<r;t+=2)this.ctx.lineTo(i[t],i[t+1]);else{let d=i[r-1],c=(r-1)/2,y=(i[c*2-2]+i[0])/2,_=(i[c*2-1]+i[1])/2,b,S;for(this.ctx.moveTo(y,_),t=0;t<c-1;t++)this.ctx.arcTo(b=i[t*2],S=i[t*2+1],i[t*2+2],i[t*2+3],d,y,_),y=b,_=S;this.ctx.arcTo(i[c*2-2],i[c*2-1],i[0],i[1],d,y,_)}return this},pt=function(t){let i=t.match(Wt),r,d,c,y,_,b=[];if(!i)throw new Error("Bad path: "+t);for(y=0;r=i[y];y++){for(c=[],c.cmd=r.charAt(0),d=r.match(ht)||[],_=0;_<d.length;_++)c[_]=+d[_];b.push(c)}return b},Kt=f.extend({init:function(t){this.svgpath=pt(t),this._super(0,0),this.svgpath[0].cmd.toLowerCase()=="m"&&(this.x=this.svgpath[0][0],this.y=this.svgpath[0][1])},draw:function(t){let i=this.svgpath,r,d;for(this.applyStyle(t),this.setTransform(t),t.beginPath(),l.setContext(t),r=0,d=i.length;r<d;r++)l[i[r].cmd].apply(l,i[r]);this.fill&&t.fill(),this.stroke&&t.stroke()}});return u(l,{distance:o,__zoom:1,Shape:f,setContext:function(t){return this.ctx=t,W(0,0),t.beginPath(),this},polygon:Z,ellipse:Ct,M:Xt,m:Gt,L:_t,l:Tt,H:At,h:$,V:Yt,v:e,C:s,c:a,S:Y,s:j,Q:m,q:x,T:bt,t:ft,A:lt,a:dt,Z:Rt,z:Rt}),l.register("image",B),l.register("circle",ot),l.register("arc",H),l.register("ellipse",st),l.register("rect",L),l.register("text",k),l.register("line",gt),l.register("path",Kt),l}function te(l,g,P){let I=Object.prototype.toString,E="function",v="string",w="array",A="object",z=!1,G=[],D=!1,M,O=l.G_vmlCanvasManager,C=/webkit|msie/i.exec(l.navigator.userAgent),J=navigator.userAgent,it=J.match(/android/i),p=J.match(/iphone|ipad|ipod/i),T=J.match(/Windows Phone/i)||J.match(/iemobile/i),o=/^([#]?)([a-z][\w\-]*)$/,n=["","LEFT","CENTER","RIGHT"],h=[],u=null,f=null,L=!1,k="Cevent"+new Date().getTime(),N=0,B={},st=function(){return l.requestAnimationFrame||l.webkitRequestAnimationFrame||l.mozRequestAnimationFrame||l.oRequestAnimationFrame||l.msRequestAnimationFrame||function(e,s){l.setTimeout(e,1e3/60)}}(),H=function(e,s){return I.call(e).slice(8,-1).toLowerCase()===s},ot=function(e,s){let a,m=0;if(H(e,w))for(;(a=e[m++])&&s(a,m)!==!1;);},gt=function(e,s){let a=It(e,s);return a>=0?(e.splice(a,1),s):null},R={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},U=function(e){return e=e||l.event,e.preventDefault||(e.preventDefault=function(){this.returnValue=!1}),e.stopPropagation||(e.stopPropagation=function(){this.cancelBubble=!0}),e},ut=function(e,s){let a=R[s];return a?function(m){let x=m.type===a;M=$.isTouchDevice=x,!(!x&&(it||p||T))&&e.call(this,m)}:e},K=function(e){return document.getElementById(e)},q=function(){return document.addEventListener?function(s,a,m){s&&(s=typeof s=="string"?K(s):s,m=ut(m,a),R[a]&&s.addEventListener(R[a],m,!0),s.addEventListener(a,m,!0))}:function(s,a,m){s&&(s=typeof s=="string"?K(s):s,s.attachEvent("on"+a,function(x){return x=U(x),m.call(x.target||x.srcElement,x)}))}}(),It=function(){return[].indexOf?function(e,s){return e.indexOf(s)}:function(e,s){for(let a=0,m=e.length;a<m;a++)if(s===e[a])return a;return-1}}(),Wt=function(e){let s=0,a=0;if(e.offsetParent)do s+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return{x:s,y:a}},ht=function(e,s,a){let m=e[k],x;return m||(m=e[k]=++N),x=B[m],x||(x=B[m]={}),s&&a!==P&&(x[s]=a),s?x[s]:x},Nt=function(e,s){if(!e)return;let a=e[k];a&&B[a]&&(s?delete B[a][s]:delete B[a])},Lt=function(e,s,a){let m=ht(e),x;ot(s.split(" "),function(Y){x=m[Y]=m[Y]||[],x.push(a)})},vt=function(e,s,a,m){let x,Y=0,j=!0;for(a.ctx.save(),a.ctx.scale(a.__zoom,a.__zoom);x=s[Y++];)x.call(e,a,m)===!1&&(j=!1);return a.ctx.restore(),j||m.preventDefault(),j},W=function(e,s,a,m){let x=ht(e,s),Y=ht(m.cv,s);x&&x.length&&h.push(e,x),Y&&Y.length&&h.push(e,Y)},et=function(e,s){let a,m;for(e.clear(),a=0,m=h.length;a<m;a+=2)vt(h[a],h[a+1],e,s);h=[],e.redraw()},at=function(e,s){e.preventDefault(),e=e.touches?e.touches[0]:e;let a,m=s._shapes,x=m.length;for(s.x=((e&&e.pageX-s._pos.x+1||l.event.offsetX+1)-1)/s.__zoom||0,s.y=((e&&e.pageY-s._pos.y+1||l.event.offsetY+1)-1)/s.__zoom||0;a=m[--x];)if(a.hitTest(s))return a},Xt=function(e,s){return function(a){a.preventDefault(),a=a.touches?a.touches[0]:a,e.lastX=e.x,e.lastY=e.y,s=e._curHover;let m=((a&&a.pageX-e._pos.x+1||l.event.offsetX+1)-1)/e.__zoom||0,x=((a&&a.pageY-e._pos.y+1||l.event.offsetY+1)-1)/e.__zoom||0;if(!(!D&&Math.abs(m-e.x)<2&&Math.abs(x-e.y)<2)){if(e.x=m,e.y=x,D=!0,!e._clicked&&z){let Y=at(a,e);Y?(s!==Y&&(W(Y,"mouseover",a,e),s&&W(s,"mouseout",a,e)),e._curHover=s=Y):s&&(W(s,"mouseout",a,e),e._curHover=s=null)}s&&W(s,"mousemove",a,e),h.length&&et(e,a)}}},Gt=function(e){return function(s){(s.type==="mousedown"||s.type==="touchstart")&&e.calcCanvasPosition(),z||(e._curHover=at(s,e)),e._curHover;let a=e._curHover,m=n[s.which||s.button];e._clicked=!0,u=e.cv,e[m]=!0,a?(W(a,"mousedown",s,e),a!==e.focused&&(W(a,"focus",s,e),e.focused&&W(e.focused,"blur",s,e))):e.focused&&(W(e.focused,"blur",s,e),e.focused=null),e.focused=a||null,h.length&&et(e,s),e[m]=!1}},_t=function(e){return function(s){e._clicked=!1,e._curHover&&(W(e._curHover,"mouseup",s,e),!D&&M&&(W(e._curHover,"tap",s,e),e.lastClick&&s.timeStamp-e.lastClick<300&&W(e._curHover,"dblclick",s,e),e.lastClick=s.timeStamp)),D=!1,h.length&&et(e,s)}},Tt=function(e){return function(s){e._curHover&&W(e._curHover,"click",s,e),h.length&&et(e,s)}},Rt=function(e){return function(s){e._curHover&&W(e._curHover,"dblclick",s,e),h.length&&et(e,s)}},At=function(){let e={specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",110:".",111:"/",187:"+",189:"-"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"}},s;return function(a,m){let x=ht(m.cv,a,{}),Y=ht(x);return function(j){if(u!==m.cv&&!m.__globalkeyevents)return;s=a=="keydown"?j.keyCode:s;let bt=e.specialKeys[s],ft=bt||String.fromCharCode(s||j.charCode).toLowerCase(),lt="",dt;if(j.altKey&&(lt+="alt+"),(j.ctrlKey||j.metaKey)&&(lt+="ctrl+"),j.shiftKey&&(lt+="shift+"),dt=Y[lt+ft]||Y[lt+e.shiftNums[ft]]||lt==="shift+"&&Y[e.shiftNums[ft]]||Y.any,dt){let Ct=vt(m,dt,m,j);return m.play||m.redraw(),Ct}}}}(),$=function(e,s){if(e=H(e,v)?g.getElementById(e):e,e.getContext||l.G_vmlCanvasManager)return new $.fn.init(e,s);throw Error("Your browser sucks")};$.forse_redraw=function(){let e,s=G.length;for(e=0;e<s;e++)G[e].redraw()},$.fn=$.prototype={init:function(e,s){this.cv=e,l.getComputedStyle?this.background=getComputedStyle(this.cv.parentElement).backgroundColor:this.background="#333",!e.getContext&&l.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(e),this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.height,this.__zoom=1,this.x=0,this.y=0,this.cv[k]?(this._shapes=ht(e,"shapes"),this._last=s):(G.push(this),this._shapes=ht(e,"shapes",[]),this.__cache=ht(e,"cache",document.createElement("canvas")),this._last=null,l.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.__cache),this.__cachectx=this.__cache&&this.__cache.getContext("2d"),this.calcCanvasPosition(),q(e,"mousemove",Xt(this),!1),q(e,"dblclick",Rt(this),!1),q(e,"click",Tt(this),!1),q(e,"mouseup",_t(this),!1),q(e,"mousedown",Gt(this),!1),q(g,"keydown",At("keydown",this),!1),q(g,"keyup",At("keyup",this),!1),C||q(g,"keypress",At("keypress",this),!1),"onselectstart"in e&&(e.onselectstart=function(){return!1},e.onmousedown=function(){return!1}))},updateCache:function(){this.__cache&&(this.__cache.width=this.cv.width,this.__cache.height=this.cv.height,gt(this._shapes,f),this.draw(),this._shapes.push(f),this.__cachectx.drawImage(this.cv,0,0))},calcCanvasPosition:function(){return this._pos=Wt(this.cv),this},get:function(e){return e=e<0?this._shapes.length+e:e,this._shapes[e]||this._shapes},getAll:function(e){let s=[],a=o.exec(e),m,x;return e==="*"?s=this._shapes.slice(0):a&&(m=a[1],x=a[2],ot(this._shapes,function(Y){Y[m]===x&&s.push(Y)})),s},remove:function(e){return Nt(gt(this._shapes,e)),this.redraw()},addId:function(e){let s=o.exec(e),a=this._last;return s&&!s[1]&&a&&(a.length?ot(a,function(m){m["#"]=e}):a["#"]=e),this},removeId:function(){let e=this._last;return e&&!e.length?e["#"]="":ot(e,function(s){s["#"]=""}),this},find:function(e){let s=this.getAll(e);return $(this.cv,s.length===1?s[0]:s)},attr:function(e,s){let a=this._last;return a&&a.attr?a.attr(e,s):ot(a,function(m){m.attr(e,s)}),this},rotate:function(e){return this.attr({rotation:e})},translate:function(e,s){return this.attr({tx:e,ty:s})},scale:function(e,s){return this.attr({scaleX:e,scaleY:s})},skewX:function(e){return this.attr({skewX:e})},skewY:function(e){return this.attr({skewY:e})},zoomTo:function(e){return H(e,"number")&&(this.__zoom=e),this},zoomIn:function(){return this.zoomTo(this.__zoom+.1)},zoomOut:function(){return this.zoomTo(this.__zoom-.1)},setGlobalKeyEvents:function(e){return this.__globalkeyevents=!!e,this},bind:function(e,s,a){let m=a||this._last,x;if(!z&&"mouseover mouseout".indexOf(e)!==-1&&(z=!0),H(e,v)&&H(s,A))for(x in s)this[x](e,s[x]);else if(H(e,A))for(x in e)this[x](e[x]);else m&&!m.length?Lt(m,e,s):ot(m,function(Y){Lt(Y,e,s)});return this},beforeDraw:function(e){return H(e,E)&&(this.__beforeDraw=e),this},afterDraw:function(e){return H(e,E)&&(this.__afterDraw=e),this},clear:function(e,s,a,m){return e=e||0,s=s||0,a=a||this.cv.width,m=m||this.cv.height,this.ctx.fillStyle=this.background,this.ctx.fillRect(e,s,a,m),this},draw:function(){let e,s=0,a=this._shapes;if(this.ctx.save(),$.__zoom=this.__zoom,this.__beforeDraw&&this.__beforeDraw.call(this,this),!O&&this.__cache&&L&&!this.play&&f)this.ctx.drawImage(this.__cache,0,0),f.draw(this.ctx);else for(;e=a[s++];)e.draw(this.ctx);return this.__afterDraw&&this.__afterDraw.call(this,this),$.__zoom=1,this.ctx.restore(),this},redraw:function(){return this.clear().draw()},loop:function(e){let s=this,a=ht(this.cv),m;return H(e,E)&&(a.loop=e),e=a.loop,m=this.play=++N,function(){m===s.play&&(st(arguments.callee),s.redraw(),e&&(s.ctx.save(),e.call(s,s),s.ctx.restore()),s.frameCount+=1)}(),this},frameCount:0,stop:function(){return delete this.play,this}},$.fn.init.prototype=$.prototype,$.addEventListener=q;function Yt(e,s){let a=o.exec(e);return function(m,x){(a&&this[a[1]]===a[2]||e==="*")&&s.call(this,m,x)}}return ot("mousemove mouseover mouseout mousedown mouseup click dblclick focus blur tap".split(" "),function(e){$.fn[e]=function(s,a){let m;return H(a,E)&&(s=Yt(s,a),m=this.cv),this.bind(e,s,m)}}),ot("keydown keypress keyup".split(" "),function(e){$.fn[e]=function(s,a){return!a&&H(s,E)&&(a=s,s="any"),s=(s+"").toLowerCase(),this.bind(s,a,ht(this.cv,e))}}),C&&($.fn.keypress=$.fn.keydown),$.fn.drag=function(e){let s,a,m,x,Y=[],j,bt="Cevent-drag"+k,ft=this._last;if(H(e,v)&&(j=e,e=arguments[1]),e&&(s=e.start,a=e.move,m=e.end,x=e.afterMove),j)return this.mousedown(j,lt).mouseup(j,Ct).mousemove(j,dt);ft&&!ft.length&&(ft=[ft]),ot(ft,function(Z){ht(Z,bt)||(ht(Z,bt,!0),Y.push(Z))}),$(this.cv,Y).mousedown(lt).mouseup(Ct).mousemove(dt);function lt(Z,pt){(Z.LEFT||M)&&(f=this,!Z.play&&!O&&!L&&Z.updateCache())}function dt(Z,pt){if(this===f){if(!L){if(s&&s.call(this,Z,pt)===!1)return f=L=null;L=!0}a&&a.call(this,Z,pt),this.rmove(Z.x-Z.lastX,Z.y-Z.lastY),x&&x.call(this,Z,pt)}}function Ct(Z,pt){this===f&&(f=L=null,m&&m.call(this,Z,pt))}return this},$.registre=$.register=function(e,s){e=e.toLowerCase();let a=e.charAt(0).toUpperCase()+e.substring(1);this[a]=s,this.prototype[e]=function(){let m=s.apply(this,arguments);return m[""]=e,this._shapes.push(m),this._last=m,this}},q(g,"mousedown",function(e){let s=e.target||e.srcElement;s=s.nodeName==="OBJECT"?s.parentNode:s,s[k]||(u=s)},!1),$.isTouchDevice=M,l.Cevent=$,$}const ct=Zt(te(window,document)),F=function(l){const g={randint:function(v){return~~(Math.random()*v)}};"bind"in Function||(Function.prototype.bind=function(v){let w=this;return function(){return w.apply(v,arguments)}});let P=Mt.extend({init:function(v){this.elem=document.getElementById(v)}}),I=function(v,w,A){return document.addEventListener?function(z,G,D){z.addEventListener(G,D,!1)}:function(z,G,D){z.attachEvent("on"+G,function(M){return M=M||w,M.preventDefault=M.preventDefault||function(){this.returnValue=!1},M.stopPropagation=M.stopPropagation||function(){this.cancelBubble=!0},D.call(M.target||M.srcElement,M)})}}(),E="mousemove mouseover mouseout mousedown mouseup click touchstart dblclick focus blur submit change".split(" ");for(let v=0;v<E.length;v++){let w=E[v];P.prototype[w]=function(A){return function(z,G){typeof z=="function"?I(this.elem,A,z):I(this.elem,A,function(D){let M=D.target||D.srcElement;M.tagName.toLowerCase()===z&&(D.stopPropagation(),G.call(M,D))},!1)}}(w)}return g.fullScreen=function(){document.documentElement.scrollHeight<l.outerHeight/l.devicePixelRatio?(document.body.style.height=l.outerHeight/l.devicePixelRatio+1+"px",setTimeout(function(){l.scrollTo(1,1)},0)):l.scrollTo(1,1)},g.getContext=function(v){return!v.getContext&&l.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(v),v.getContext("2d")},g.extend=function(v,w){let A;for(A in w)w.hasOwnProperty(A)&&!(A in v)&&(v[A]=w[A]);return v},g.calcPieces=function(v){let w=v.image.width,A=v.image.height,z=document.getElementById("set-parts"),G,D;z.innerHTML="";for(let M=0;M<v.options.length;M+=1){let O=~~Math.sqrt(w*A/v.options[M]),C=~~(w/O),J=~~(A/O);for(;C*J<v.options[M];)O--,C=~~(w/O),J=~~(A/O);D!==C*J&&(D=C*J,G=document.createElement("option"),G.value=v.options[M],G.innerHTML=v.template.replace("%d",D),z.appendChild(G),v.options[M]===v.selected&&(G.selected=!0))}},g.addEvent=I,g.$=function(){let v=P();return function(w){return v.elem=document.getElementById(w),v}}(),g.getElement=function(v){return document.getElementById(v)},g.ajax=function(v){let w=new XMLHttpRequest;w.onreadystatechange=function(){w.readyState===XMLHttpRequest.DONE&&(w.status===200?v.success&&v.success(w.responseText):v.error&&v.error())},w.open("GET",v.url,!0),w.send()},l.Util=l.Util||g,g}(window),tt=function(){};tt.prototype.setMaxListeners=function(l){this._events||(this._events={}),this._events.maxListeners=l};Array.isArray=Array.isArray||function(l){return l.sort&&l.length&&l.slice};tt.prototype.emit=function(l){if(l==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;let g=this._events[l];if(!g)return!1;if(typeof g=="function"){switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:let P=Array.prototype.slice.call(arguments,1);g.apply(this,P)}return!0}if(Array.isArray(g)){let P=Array.prototype.slice.call(arguments,1),I=g.slice();for(let E=0,v=I.length;E<v;E++)I[E].apply(this,P);return!0}return!1};tt.prototype.publish=tt.prototype.emit,tt.prototype.addListener=function(l,g){if(typeof g!="function")throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",l,g),!this._events[l])this._events[l]=g;else if(Array.isArray(this._events[l])){if(this._events[l].push(g),!this._events[l].warned){let P;this._events.maxListeners!==void 0?P=this._events.maxListeners:P=10,P&&P>0&&this._events[l].length>P&&(this._events[l].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[l].length),console.trace())}}else this._events[l]=[this._events[l],g];return this};tt.prototype.on=tt.prototype.subscribe=tt.prototype.addListener,tt.prototype.once=function(l,g){function P(){I.removeListener(l,P),g.apply(this,arguments)}if(typeof g!="function")throw new Error(".once only takes instances of Function");let I=this;return P.listener=g,I.on(l,P),this};tt.prototype.removeListener=function(l,g){if(typeof g!="function")throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[l])return this;let P=this._events[l];if(Array.isArray(P)){let I=-1;for(let E=0,v=P.length;E<v;E++)if(P[E]===g||P[E].listener&&P[E].listener===g){I=E;break}if(I<0)return this;P.splice(I,1),P.length==0&&delete this._events[l]}else(P===g||P.listener&&P.listener===g)&&delete this._events[l];return this};tt.prototype.unsubscribe=tt.prototype.removeListener,tt.prototype.removeAllListeners=function(l){return arguments.length===0?(this._events={},this):(l&&this._events&&this._events[l]&&(this._events[l]=null),this)};tt.prototype.listeners=function(l){return this._events||(this._events={}),this._events[l]||(this._events[l]=[]),Array.isArray(this._events[l])||(this._events[l]=[this._events[l]]),this._events[l]};tt.mixin=function(l){for(let g in tt.prototype)l.prototype[g]||(l.prototype[g]=tt.prototype[g])};function Q(){return window.devicePixelRatio||1}(function(l,g,P){let I=F.getContext(l.createElement("canvas")),E=Math.abs,v=Math.PI/180,w=F.getContext(l.createElement("canvas")),A=navigator.userAgent,z=A.match(/android/i),G=A.match(/iphone|ipad|ipod/i),D=A.match(/Windows Phone/i)||A.match(/iemobile/i),M=!z&&!G&&!D,O=20;function C(o,n){if(o.rotation%360||n.rotation%360||n.hide||o.hide||o.row!=n.row&&o.col!=n.col)return;let h=o.tx-n.tx,u=o.ty-n.ty,f=o.col-n.col,L=o.row-n.row,k=o.width,N=o.height;if(o.size,(f==-1&&h<0&&E(h+k)<O||f==1&&h>=0&&E(h-k)<O)&&u<=O&&u>=-O)return[o.col>n.col?-E(h)+k:E(h)-k,n.ty-o.ty];if((L==-1&&u<0&&E(u+N)<O||L==1&&u>=0&&E(u-N)<O)&&h<=O&&h>=-O)return[n.tx-o.tx,o.row>n.row?-E(u)+N:E(u)-N]}let J=ct.Shape.extend({type:"piece",init:function(o,n,h,u,f,L,k){this.flat=k,this._super(o,n),this.img=h,this.originalImg=h,this.size=Math.max(u,f),this.width=u,this.height=f,this.diagonal=~~Math.sqrt(u*u+f*f),this.edges=L,this.lastRotation=0,this.size/2,this.tx=this.x+this.width/2,this.ty=this.y+this.height/2,this.x=-this.width/2,this.y=-this.height/2},draw_path:function(o){let n=this.size,h,u=0;for(o.beginPath(),o.moveTo(this.x,this.y);u<4;u++){h=this.edges[u],n=u%2?this.height:this.width;let f=u%2?this.height:this.width,L=u%2?this.width:this.height,k=u%2?this.y:this.x,N=u%2?this.x:this.y;h?this[h](o,f,L,k,N):o.lineTo(k+n,N),o.rotate(Math.PI/2)}o.closePath()},render:function(o,n){o=o||this.ox||0,n=n||this.oy||0,this.originalTX=this.originalTX||this.tx,this.originalTY=this.originalTY||this.ty;let h=this.ctx||F.getContext(l.createElement("canvas")),u=this.size+.5;w.canvas.width=h.canvas.width=u*2,w.canvas.height=h.canvas.height=u*2,w.save(),h.save(),this.applyStyle(h),w.lineWidth=.5,h.lineWidth=.5,h.translate(this.width,this.height),h.rotate(this.rotation*v),w.translate(this.width,this.height),w.rotate(this.rotation*v),this.draw_path(h),this.draw_path(w),h.fill(),w.drawImage(this.originalImg,-this.originalTX-o,-this.originalTY-n),this.stroke&&(w.globalCompositeOperation="lighter",w.shadowOffsetY=1.5,w.shadowOffsetX=1.5,w.shadowBlur=0,w.shadowColor="rgba(255, 255, 255, .4)",w.lineWidth=1.5,w.strokeStyle="rgba(0, 0, 0, .4)",w.stroke(),w.globalCompositeOperation="darken",w.shadowBlur=1,w.shadowOffsetY=-1,w.shadowOffsetX=-1,w.shadowBlur=2,w.shadowColor="rgba(0, 0, 0, .2)",w.lineWidth=2,w.strokeStyle="rgba(0, 0, 0, .4)",w.stroke(),w.clip()),w.restore(),h.restore(),h.globalCompositeOperation="source-in",h.globalCompositeOperation!=="source-in"&&(h.globalCompositeOperation="source-atop"),h.drawImage(w.canvas,0,0),this.ctx||(this.tx+=this.offset),this.img=h.canvas,this.ctx=h,this.ox=o,this.oy=n},outside:function(o,n,h,u,f){if(this.flat)return o.lineTo(u+n,f);o.lineTo(u+n*.34,f),o.bezierCurveTo(u+n*.5,f,u+n*.4,f+h*-.15,u+n*.4,f+h*-.15),o.bezierCurveTo(u+n*.3,f+h*-.3,u+n*.5,f+h*-.3,u+n*.5,f+h*-.3),o.bezierCurveTo(u+n*.7,f+h*-.3,u+n*.6,f+h*-.15,u+n*.6,f+h*-.15),o.bezierCurveTo(u+n*.5,f,u+n*.65,f,u+n*.65,f),o.lineTo(u+n,f)},inside:function(o,n,h,u,f){if(this.flat)return o.lineTo(u+n,f);o.lineTo(u+n*.35,f),o.bezierCurveTo(u+n*.505,f+.05,u+n*.405,f+h*.155,u+n*.405,f+h*.1505),o.bezierCurveTo(u+n*.3,f+h*.3,u+n*.5,f+h*.3,u+n*.5,f+h*.3),o.bezierCurveTo(u+n*.7,f+h*.29,u+n*.6,f+h*.15,u+n*.6,f+h*.15),o.bezierCurveTo(u+n*.5,f,u+n*.65,f,u+n*.65,f),o.lineTo(u+n,f)},draw:function(o){if(this.hide)return;let n=this.x-this.width/2-.5,h=this.y-this.height/2-.5;if(M){this.setTransform(o),o.drawImage(this.img,n,h);return}this.rotation!==this.lastRotation&&(this.render(),this.lastRotation=this.rotation),o.drawImage(this.img,n+this.tx,h+this.ty)},check:function(o){let n;if(o.type==="piece")n=C(this,o);else{let h,u=o.pieces.length;for(h=0;h<u&&!(n=C(this,o.pieces[h]));h++);}return n&&this.rmove(n[0],n[1]),n},hitTest:function(o){if(!this.hide)return this.setTransform(I),this.draw_path(I),I.isPointInPath(o.x*Q(),o.y*Q())}}),it=ct.Shape.extend({type:"group",init:function(){this.pieces=[],this._super(0,0)},draw:function(o){if(this.hide)return;let n,h=this.pieces.length;for(n=0;n<h;n++)this.pieces[n].draw(o)},hitTest:function(o){let n,h=this.pieces.length;for(n=0;n<h;n++)if(this.pieces[n].hitTest(o))return!0},check:function(o){let n,h=this.pieces.length,u;if(o.type==="piece"){for(n=0;n<h;n++)if(u=C(this.pieces[n],o))return this.rmove(u[0],u[1]),!0}else{let f,L=o.pieces.length;for(n=0;n<h;n++)for(f=0;f<L;f++)if(u=C(this.pieces[n],o.pieces[f]))return this.rmove(u[0],u[1]),!0}},rmove:function(o,n){let h,u=this.pieces.length;for(h=0;h<u;h++)this.pieces[h].rmove(o,n);this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty},add:function(){this.pieces=this.pieces.concat.apply(this.pieces,arguments),this.minPieceX=T(this.pieces,"tx"),this.minPieceY=T(this.pieces,"ty"),this.width=p(this.pieces,"tx").tx-this.minPieceX.tx,this.height=p(this.pieces,"ty").ty-this.minPieceY.ty,this.width+=this.pieces[0].width,this.height+=this.pieces[0].height,this.x=this.pieces[0].x,this.y=this.pieces[0].y,this.tx=this.minPieceX.tx,this.ty=this.minPieceY.ty}});function p(o,n){let h=o[0][n],u=0;for(let f=1;f<o.length;f++)o[f][n]>h&&(h=o[f][n],u=f);return o[u]}function T(o,n){let h=o[0][n],u=0;for(let f=1;f<o.length;f++)o[f][n]<h&&(h=o[f][n],u=f);return o[u]}ct.register("group",it),ct.register("piece",J)})(document);const zt=function(l,g,P){let I="inside",E="outside",v=null,w,A=[I,E],z=0,G={spread:.7,offsetTop:0,maxWidth:g.innerWidth,maxHeight:g.innerHeight,defaultImage:"images/puzzle/scottwills_meercats.jpg",piecesNumberTmpl:"%d Pieces",redirect:"",border:!0,defaultPieces:10,shuffled:!1,rotatePieces:!0,numberOfPieces:[10,20,30,40,50,60,70,80,90,100],squarePieces:!1},D=45,M=Q();function O(){return A[F.randint(2)]}let C={};C.Jigsaw=Mt.extend({init:function(p){let T=new tt,o=this;this.container=l.body,this.opts=p=F.extend(p||{},G),this.max_width=p.maxWidth,this.max_height=p.maxHeight,F.$("redirect-form").action=p.redirect,w=p.defaultImage,this.eventBus=T,this.ce=new ct("canvas"),this.ui=new C.UI(T,p.defaultPieces||10),this.tmp_img=l.createElement("img"),this.img=l.getElementById("image"),this.ctx=F.getContext(this.img),this.preview=l.getElementById("image-preview"),this.previewCtx=F.getContext(this.preview),this.parts=p.defaultPieces||10,this.tmp_img.onload=function(){o.original=this,o.draw_image(this),F.calcPieces({image:o.img,template:o.opts.piecesNumberTmpl,selected:o.parts,options:o.opts.numberOfPieces}),o.render()},this.tmp_img.onerror=function(){w&&o.set_image(w)},J(this.ce,T,this.opts.rotatePieces),T.on(C.Events.JIGSAW_COMPLETE,function(){o.ui.stop_clock(),p.redirect?o.redirect():o.ui.show_time()}),p.shuffled&&T.on(C.Events.RENDER_FINISH,this.shuffle.bind(this)),T.on(C.Events.PARTS_NUMBER_CHANGED,this.set_parts.bind(this)),T.on(C.Events.RENDER_REQUEST,this.render.bind(this)),T.on(C.Events.JIGSAW_SHUFFLE,this.shuffle.bind(this)),T.on(C.Events.JIGSAW_SET_IMAGE,this.set_image.bind(this)),T.on(C.Events.SHOW_EDGE,function(){o.ce.find("#middle").attr("hide",!0),o.ce.find("#edge").attr("hide",!1),o.ce.redraw()}),T.on(C.Events.SHOW_MIDDLE,function(){o.ce.find("#middle").attr("hide",!1),o.ce.find("#edge").attr("hide",!0),o.ce.redraw()}),T.on(C.Events.SHOW_ALL,function(){o.ce.find("*").attr("hide",!1),o.ce.redraw()}),F.addEvent(g,"resize",this.resize.bind(this)),this.resize(),this.set_image()},resize:function(){let T=this.ce.cv,o=this.width(),n=this.height()-D;T.width=o*Q(),T.height=n*Q(),T.style.width=o+"px",T.style.height=n+"px",this.ce.redraw(),ct.isTouchDevice&&F.fullScreen()},redirect:function(){F.$("t").value=this.ui.time(),F.$("p").value=this.parts,F.$("redirect-form").submit()},set_parts:function(p){this.parts=p},set_image:function(p){this.ce.cv.className="loading",this.tmp_img.src=p||w},width:function(){return this.container.offsetWidth},height:function(){return this.container.offsetHeight},draw_image:function(p,T,o){let n=T||this.max_width*Q(),h=o||this.max_height*Q(),u,f,L=this.ctx;if(n>this.width()||h>this.height()-D){let k=Math.min(this.width()/n,(this.height()-D)/h);n*=k,h*=k}if(p.width>n||p.height>h){let k=Math.min(n/p.width,h/p.height);u=~~(p.width*k)*Q(),f=~~(p.height*k)*Q(),L.canvas.width=u,L.canvas.height=f,L.drawImage(p,0,0,p.width,p.height,0,0,u,f)}else L.canvas.width=p.width*Q(),L.canvas.height=p.height*Q(),L.drawImage(p,0,0,p.width,p.height,0,0,L.canvas.width,L.canvas.height)},clear:function(){this.ce._shapes=[]},shuffle:function(){let p=this.ce.getAll("piece");if(this.__pieces)this.ce._shapes=p=this.__pieces.slice(0);else return;this.ce.clear();let T,o=p.length,n;p[0].size;let h=this.opts.spread,u=this.width()*Q(),f=(this.height()-D)*Q(),L=u*h,k=f*h,N=~~((u-L)/2),B=~~((f-k)/2);for(T=0;T<o;T++)n=p[T],n.tx=F.randint(L)+n.tx%1+N,n.ty=F.randint(k)+n.tx%1+B,this.opts.rotatePieces&&(n.rotation=F.randint(4)*90);this.opts.shuffled&&(this.ce.cv.className="",this.ui.init_clock()),this.ce.find("*").attr({hide:!1}),this.ce.shuffled=!0,this.ce.redraw()},render:function(){this.opts.shuffled?(this.ce.cv.className="loading",this.ce.clear(),this.ui.stop_clock()):this.ce.cv.className="",this.ce.shuffled=!1;let p,T,o,n,h=[],u=[],f=this.img.width,L=this.img.height,k=~~Math.sqrt(f*L/this.parts),N=~~(f/k),B=~~(L/k),st=0,H=0,ot=++z,gt;for(this.flag=ot;N*B<this.parts;)k--,N=~~(f/k),B=~~(L/k);let R=~~(f/N),U=~~(L/B);R=R%2?R:R-1,U=U%2?U:U-1,gt=~~(this.width()/2*Q()-R*N/2),this.clear();let ut=~~((f-N*R)/2),K=~~((L-B*U)/2);ut=ut>=0?ut:0,K=K>=0?K:0,this.preview.style.marginTop=this.opts.offsetTop+"px",this.preview.width=R*N,this.preview.height=U*B,this.preview.style.width=this.preview.width/Q()+"px",this.preview.style.height=this.preview.height/Q()+"px",this.previewCtx.globalAlpha=.3,this.previewCtx.drawImage(this.img,ut,K,R*N,U*B,0,0,R*N,U*B),(function q(){if(st<N&&ot===this.flag){H<B?(p=H===0?v:o===I?E:I,T=st===N-1?v:O(),o=H===B-1?v:O(),n=st===0?0:u[H]===I?E:I,this.ce.piece(R*st,U*H+this.opts.offsetTop,g.G_vmlCanvasManager?this.tmp_img:this.img,R,U,[p,T,o,n],this.opts.squarePieces).attr({col:st,row:H,offset:gt,stroke:this.opts.border?"black":""}).get(-1).render(ut,K-this.opts.offsetTop),this.opts.shuffled||this.ce.redraw(),H===0||st===0||st===N-1||H===B-1?this.ce.addId("edge"):this.ce.addId("middle"),h.push(T),H++):(st++,H=0,u=h,h=[]),setTimeout(q.bind(this),20);return}else this.flag===ot&&(this.__pieces=this.ce.get().slice(0),this.ce.redraw(),this.eventBus.emit(C.Events.RENDER_FINISH))}).bind(this)()}}),C.Events={PARTS_NUMBER_CHANGED:"PartsNumberChanged",RENDER_REQUEST:"RenderRequestEvent",RENDER_FINISH:"RenderFinishEvent",JIGSAW_RENDERED:"JigsawRenderedEvent",JIGSAW_SET_IMAGE:"JigsawSetImageEvent",JIGSAW_SHUFFLE:"JigsawShuffleEvent",SHOW_PREVIEW:"JigsawShowPreview",SHOW_HELP:"JigsawShowHelp",SHOW_FILEPICKER:"JigsawShowFilepicker",SHOW_EDGE:"ShowEdgeEvent",SHOW_MIDDLE:"ShowMiddleEvent",SHOW_ALL:"ShowAllEvent",JIGSAW_COMPLETE:"JigsawCompleteEvent",PIECES_CONNECTED:"PieceConnectedEvent"},C.GET=function(){if(location.query)return;let p=location.search.replace(/^[?]/,"").split("&"),T=0,o=p.length,n={};for(;T<o;T++){if(!p[T])continue;let h=p[T].split("=");n[unescape(h[0])]=unescape(h[1])}return n},C.UI=Mt.extend({init:function(p,T){this.eventBus=p,this.clock=F.$("clock"),it(this,p),p.on(C.Events.JIGSAW_SHUFFLE,this.init_clock.bind(this)),p.on(C.Events.SHOW_PREVIEW,this.show_preview.bind(this)),p.on(C.Events.SHOW_HELP,this.show_help.bind(this)),p.on(C.Events.SHOW_FILEPICKER,this.show_filepicker.bind(this))},stop_clock:function(){z++},init_clock:function(){let p=this;this.ini=new Date().getTime(),this.uuid=z,function T(){p.uuid===z&&(p.clock.innerHTML=p.time(),setTimeout(T,1e3))}()},show_preview:function(){let p=F.getElement("image-preview");p.className=p.className==="show"?"hide":"show",p.style.marginLeft=-(p.width/2/M)+"px"},show_time:function(){this.show_modal("congrat"),F.getElement("time").innerHTML=this.clock.innerHTML,F.getElement("time-input").value=this.clock.innerHTML},time:function(){let p=~~((new Date().getTime()-this.ini)/1e3),T=p%60,o=~~(p/60),n=~~(o/60);return o%=60,(n>9?n:"0"+n)+":"+(o>9?o:"0"+o%60)+":"+(T>9?T:"0"+T)},show_modal:function(p){Dt.Modal.open(p)},show_filepicker:function(){this.show_modal("create-puzzle")},show_help:function(){this.show_modal("help")}});function J(p,T,o){p.drag("*",{start:function(n,h){n.cv.style.cursor="move",n.lastX*=Q(),n.lastY*=Q(),this.handleX=n.lastX-this.tx,this.handleY=n.lastY-this.ty},move:function(n,h){n.x*=Q(),n.y*=Q(),n.x+=n.lastX-this.tx-this.handleX,n.y+=n.lastY-this.ty-this.handleY},afterMove:function(n,h){let u=~~(this.width/2),f=~~(this.height/2),L=this.x+this.tx+u,k=this.y+this.ty+f,N=n.cv.width,B=n.cv.height;this.rotation/45%2&&(u=this.diagonal/2,f=this.diagonal/2);let st=0,H=0;L-u<0?st=L-u:L+u>N&&(st=L+u-N),k-f<0?H=k-f:k+f>B&&(H=k+f-B),this.rmove(-st,-H)},end:function(n,h){if(n.cv.style.cursor="default",!n.shuffled)return;let u=n.getAll("piece").concat(n.getAll("group")),f=0,L=u.length,k=this;for(;f<L;f++)u[f]!==this&&k.check(u[f])&&(n.remove(k),n.remove(u[f]),n._curHover=n.group().get(-1),n._curHover.add(k.pieces||k,u[f].pieces||u[f]),k=n._curHover,n.focused=null);this!==k&&T.emit(C.Events.PIECES_CONNECTED),!p.getAll("piece").length&&p.getAll("group").length===1&&p.shuffled&&(p.shuffled=!1,T.emit(C.Events.JIGSAW_COMPLETE)),k.type==="group"&&(n.remove(k),n._shapes.unshift(k))}}).focus("*",function(n,h){n.remove(this),n._shapes.push(this)}),F.addEvent(p.cv,"contextmenu",function(n){o&&p.focused&&(p.focused.rotation=(p.focused.rotation+45)%360,p.redraw()),n.preventDefault()}),o&&(p.keydown("right",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation+45)%360),!1}).keydown("left",function(){return this.focused&&(this.focused.rotation=(this.focused.rotation-45)%360),!1}),p.tap("*",function(n,h){ct.isTouchDevice&&p.focused&&(p.focused.rotation=(p.focused.rotation+45)%360,p.redraw())}))}function it(p,T){function o(h){let u=h[0];if(!u.type.match(/image.*/)){F.getElement("image-error").style.display="block";return}let f=new FileReader;f.onloadend=function(L){T.emit(C.Events.JIGSAW_SET_IMAGE,this.result),n()},f.readAsDataURL(u)}g.FileReader&&new FileReader().onload===null&&(F.getElement("create").style.display="block",F.$("image-input").change(function(){o(this.files)}),"ondragenter"in g&&"ondrop"in g&&(F.getElement("dnd").style.display="block",l.addEventListener("dragenter",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),l.addEventListener("dragover",function(h){return h.stopPropagation(),h.preventDefault(),!1},!1),l.addEventListener("drop",function(h){h.stopPropagation(),h.preventDefault();let u=h.dataTransfer;o(u.files)},!1)));function n(){return Dt.Modal.close(),!1}F.$("set-parts").change(function(){T.emit(C.Events.PARTS_NUMBER_CHANGED,+this.value),T.emit(C.Events.RENDER_REQUEST)}),ct.addEventListener("game-options","mousedown",function(h){let u=h.target||h.srcElement;C.Events[u.id]&&(h.preventDefault(),T.emit(C.Events[u.id]))})}return tt.mixin(C.Jigsaw),C}(document,window),Dt=function(){let l=0,g=window.Audio&&new Audio().canPlayType,P=0,I=function(O){return document.getElementById(O)},E,v,w,A;function z(){E=I("modal-window"),v=I("modal-window-msg"),w=I("modal-window-close"),A=I("overlay");let O=ct.isTouchDevice?"touchstart":"click";ct.addEventListener(A,O,D),ct.addEventListener(w,O,D)}function G(O,C){E||z();let J=E.style,it=I(O);it.className="",Dt.Modal.currentContent=it,v.appendChild(it);let p=E.offsetWidth;J.marginLeft=-p/2+"px",E.className="modal",A.className=""}function D(O){O&&O.preventDefault(),E.className="modal hide",A.className="hide";let C=Dt.Modal.currentContent;return setTimeout(function(){C&&(C.className="hide",document.body.appendChild(C))},600),!1}function M(O,C){if(!g)return;let J;for(this.file=O,P=C,this.audio=[],J=0;J<C;J++)this.audio[J]=new Audio;const it=(function(){document.removeEventListener("touchstart",it),document.removeEventListener("mousedown",it),this.load()}).bind(this);document.addEventListener("touchstart",it),document.addEventListener("mousedown",it)}return M.prototype.load=function(){if(!g||this._loaded)return;this._loaded=!0;const O=this.audio[0].canPlayType("audio/mp3")?".mp3":".wav";for(let C=0;C<P;C++)this.audio[C].src=this.file+O,this.audio[C].volume=0,this.audio[C].load()},M.prototype.play=function(){g&&(this.audio[l].volume=1,this.audio[l].play(),l=(l+1)%P)},{Sound:M,Modal:{open:G,close:D}}}();window.addEventListener("DOMContentLoaded",function(){const l=new Dt.Sound("sound/click",10),g=new zt.Jigsaw({defaultImage:"images/default-puzzle.png",piecesNumberTmpl:"%d Pieces",numberOfPieces:[10,20,30,40,50,60,70,80,90,100],defaultPieces:10});g.set_image(zt.GET.image),g.eventBus.on(zt.Events.PIECES_CONNECTED,function(){l.play()}),zt.GET.image&&g.set_image(zt.GET.image)});
